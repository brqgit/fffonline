(()=>{var u=e=>document.querySelector(e),R=e=>Array.from(document.querySelectorAll(e));function y(e){let t=document.querySelector("#log");if(!t)return;let s=document.createElement("div");s.textContent=e,t.prepend(s)}var G=window.AudioContext||window.webkitAudioContext,p=null,L=null,x=!1;function $(){G&&(p||(p=new G,L=p.createGain(),L.gain.value=.18,L.connect(p.destination)))}function A(){p&&p.state==="suspended"&&p.resume()}function v(e=440,t=.1,s="sine",a=1,o=0){if(!p||x)return;A();let r=p.createOscillator(),l=p.createGain();r.type=s,r.frequency.setValueAtTime(e,p.currentTime+o),l.gain.setValueAtTime(1e-4,p.currentTime+o),l.gain.exponentialRampToValueAtTime(Math.max(2e-4,a),p.currentTime+o+.01),l.gain.exponentialRampToValueAtTime(1e-4,p.currentTime+o+t),r.connect(l),l.connect(L),r.start(p.currentTime+o),r.stop(p.currentTime+o+t+.02)}function C(e){!p||x||({start:()=>{v(520,.08,"triangle",.7,0),v(780,.09,"triangle",.6,.08)},play:()=>{v(420,.07,"sine",.7,0),v(560,.08,"sine",.6,.06)},defense:()=>{v(280,.09,"square",.6,0),v(200,.12,"sine",.5,.08)},attack:()=>{v(300,.06,"sawtooth",.7,0),v(220,.06,"sawtooth",.6,.05)},hit:()=>{v(160,.07,"square",.6,0)},overflow:()=>{v(600,.1,"triangle",.6,0)},death:()=>{v(420,.08,"sawtooth",.6,0),v(260,.12,"sawtooth",.55,.06)},end:()=>{v(600,.06,"triangle",.6,0),v(400,.06,"triangle",.5,.05)},crit:()=>{v(120,.08,"square",.75,0),v(90,.12,"square",.7,.06)},error:()=>{v(140,.05,"square",.6,0),v(140,.05,"square",.6,.06)}}[e]||(()=>{}))()}var k=null,F=null,B=!1,M="menu",oe={menu:{bpm:84,leadBase:196,bassBase:98,leadWave:"triangle",bassWave:"sine",scale:[0,3,5,7,5,3,0,-5]},vikings:{bpm:76,leadBase:174.61,bassBase:87.31,leadWave:"sawtooth",bassWave:"sine",scale:[0,3,5,7,10,7,5,3]},animais:{bpm:90,leadBase:220,bassBase:110,leadWave:"square",bassWave:"sine",scale:[0,2,5,7,9,7,5,2]},pescadores:{bpm:96,leadBase:196,bassBase:98,leadWave:"triangle",bassWave:"triangle",scale:[0,2,4,7,9,7,4,2]},floresta:{bpm:68,leadBase:207.65,bassBase:103.83,leadWave:"sine",bassWave:"sine",scale:[0,3,5,10,5,3,0,-2]},combat:{bpm:118,leadBase:220,bassBase:110,leadWave:"sawtooth",bassWave:"square",scale:[0,2,3,5,7,8,7,5],perc:!0,ac:4}};function E(e){if(!G||x||($(),A(),e&&e!==M&&B&&O(),M=e||M||"menu",B))return;B=!0;let t=oe[M]||oe.menu;k=p.createGain(),k.gain.value=1e-4,k.connect(L);let s=M==="combat"?.22:.18;k.gain.exponentialRampToValueAtTime(s,p.currentTime+.4);let a=60/t.bpm,o=t.scale.length,r=()=>{if(!B||!k)return;let d=p.currentTime;for(let c=0;c<o;c++){let h=t.leadBase*Math.pow(2,t.scale[c]/12),f=p.createOscillator(),g=p.createGain();f.type=t.leadWave,f.frequency.setValueAtTime(h,d+c*a),g.gain.setValueAtTime(1e-4,d+c*a),g.gain.exponentialRampToValueAtTime(M==="combat"?.13:.11,d+c*a+.01),g.gain.exponentialRampToValueAtTime(1e-4,d+c*a+a*.92),f.connect(g),g.connect(k),f.start(d+c*a),f.stop(d+c*a+a)}for(let c=0;c<o;c+=2){let h=p.createOscillator(),f=p.createGain();h.type=t.bassWave,h.frequency.setValueAtTime(t.bassBase,d+c*a),f.gain.setValueAtTime(1e-4,d+c*a),f.gain.exponentialRampToValueAtTime(M==="combat"?.1:.09,d+c*a+.01),f.gain.exponentialRampToValueAtTime(1e-4,d+c*a+a*.96),h.connect(f),f.connect(k),h.start(d+c*a),h.stop(d+c*a+a)}if(t.perc)for(let c=0;c<o;c++){let h=p.createOscillator(),f=p.createGain();if(h.type="square",h.frequency.setValueAtTime(1600,d+c*a),f.gain.setValueAtTime(1e-4,d+c*a),f.gain.exponentialRampToValueAtTime(.07,d+c*a+.005),f.gain.exponentialRampToValueAtTime(1e-4,d+c*a+a*.2),h.connect(f),f.connect(k),h.start(d+c*a),h.stop(d+c*a+a*.2),t.ac&&c%t.ac===0){let g=p.createOscillator(),m=p.createGain();g.type="sine",g.frequency.setValueAtTime(120,d+c*a),m.gain.setValueAtTime(1e-4,d+c*a),m.gain.exponentialRampToValueAtTime(.12,d+c*a+.01),m.gain.exponentialRampToValueAtTime(1e-4,d+c*a+a*.3),g.connect(m),m.connect(k),g.start(d+c*a),g.stop(d+c*a+a*.3)}}};r();let l=a*o*1e3;F=setInterval(r,l-25)}function O(){if(B&&(B=!1,F&&(clearInterval(F),F=null),k)){try{k.gain.exponentialRampToValueAtTime(1e-4,p.currentTime+.25)}catch{}setTimeout(()=>{try{k.disconnect()}catch{}k=null},300)}}function K(){if(G){$();try{A()}catch{}try{E("menu")}catch{}if(p&&p.state!=="running")try{p.resume().then(()=>E("menu")).catch(()=>{})}catch{}if(!B){let e=0,t=setInterval(()=>{if(e++,B||e>8){clearInterval(t);return}try{$(),A(),E("menu")}catch{}},800)}}}function re(e){x=!x,L&&(L.gain.value=x?0:.18),k&&(k.gain.value=x?0:.18),e&&(e.textContent=x?"\u{1F507} Mudo":"\u{1F50A} Som")}function ie(e){let{G:t,summon:s,renderAll:a,legalTarget:o,attackCard:r,attackFace:l,rand:d,newTurn:c}=e,h=t.aiHand.filter(m=>m.cost<=t.aiMana&&m.harvestCost<=t.aiHarvest).sort((m,P)=>P.cost-m.cost);for(;h.length&&t.aiBoard.length<5&&t.aiMana>0;){let m=h.shift(),P=t.aiHand.findIndex(V=>V.id===m.id);if(P>-1&&m.cost<=t.aiMana&&m.harvestCost<=t.aiHarvest){t.aiHand.splice(P,1);let V=m.hp>=m.atk+1?Math.random()<.7?"defense":"attack":Math.random()<.3?"defense":"attack";s("ai",m,V),t.aiMana-=m.cost,t.aiHarvest-=m.harvestCost}}a();let f=t.aiBoard.filter(m=>m.canAttack&&m.stance!=="defense");function g(){if(!f.length){t.current="player",c();return}let m=f.shift(),P=t.playerBoard.filter(V=>o("player",V));P.length?r(m,d(P)):l(m,"player"),setTimeout(g,500)}setTimeout(g,500)}var je=Object.freeze({MANA:"mana",ENERGIA:"energia",COLHEITA:"colheita"}),T=Object.freeze({FURIOSO:"Furioso",PROTETOR:"Protetor",PERCEPCAO:"Percep\xE7\xE3o",CURA:"Cura",BENCAO:"B\xEAn\xE7\xE3o",CORVO:"Corvo",SERPENTE:"Serpente"}),We=Object.freeze({UNIDADE:"Unidade",RITUAL:"Ritual",LENDA_MITICA:"Lenda M\xEDtica"}),Ue=Object.freeze({VIKINGS:"Vikings",FLORESTA:"Floresta",SOMBRAS:"Sombras",RUNICO:"R\xFAnico",MITICO:"M\xEDtico"});var D=e=>e[Math.floor(Math.random()*e.length)],b=(e,t,s)=>Math.max(t,Math.min(s,e)),xe=()=>Math.random().toString(36).slice(2),Be={P:T.PROTETOR,F:T.FURIOSO,PE:T.PERCEPCAO,C:T.CURA,B:T.BENCAO,CV:T.CORVO,S:T.SERPENTE},Ee={D1:"draw1",H2:"heal2",P1:"ping1",BR1:"buffRandom1",BA1:"buffAlliesAtk1"};function Ae(e){let t=e.toLowerCase();return t.includes("berserker")?{classe:"tank",subclasse:"Berserker"}:t.includes("guardi\xE3o do v\xE9u")||t.includes("v\xE9u")?{classe:"control",subclasse:"Guardi\xE3o do V\xE9u"}:t.includes("guardi\xE3o")?{classe:"tank",subclasse:"Guardi\xE3o"}:t.includes("uivante")?{classe:"tank",subclasse:"Uivante"}:t.includes("ca\xE7ador")?{classe:"dps",subclasse:"Ca\xE7ador"}:t.includes("runomante")?{classe:"dps",subclasse:"Runomante"}:t.includes("serpente")?{classe:"dps",subclasse:"Serpente"}:t.includes("curandeir")?{classe:"support",subclasse:"Curandeiro"}:t.includes("tot\xEAmico")||t.includes("totemico")?{classe:"support",subclasse:"Tot\xEAmico"}:t.includes("sacerdote")||t.includes("tecel\xE3o")?{classe:"support",subclasse:"Tecel\xE3o"}:t.includes("xam\xE3")?{classe:"control",subclasse:"Xam\xE3"}:t.includes("corvo")?{classe:"control",subclasse:"Corvo"}:t.includes("guerreiro")?{classe:"dps",subclasse:"Guerreiro"}:t.includes("raider")?{classe:"dps",subclasse:"Raider"}:t.includes("batalhador")?{classe:"dps",subclasse:"Batalhador"}:t.includes("mago")||t.includes("mistico")?{classe:"support",subclasse:"Mago"}:t.includes("sombras")||t.includes("encapuzado")?{classe:"control",subclasse:"Sombras"}:t.includes("navegador")?{classe:"support",subclasse:"Navegador"}:{classe:"",subclasse:""}}var U=e=>{let[t,s,a,o,r,l,d,c=0,h=0,f=0]=e,g=Ae(t||"");return{name:t,emoji:s,tribe:a,atk:o,hp:r,cost:l,harvestCost:f,text:d,kw:c?c.split("|").map(m=>Be[m]):[],battlecry:h?Ee[h]:void 0,classe:g.classe,subclasse:g.subclasse,id:xe()}},q={vikings:[["Lavrador de Lan\xE7a","\u{1F9D4}\u200D\u{1F33E}","Viking",2,2,2,"Disciplinado"],["Camponesa Curandeira","\u{1F469}\u200D\u{1F33E}\u2728","Viking",2,3,3,"Entra: cura 2","","H2"],["Ceifeiro Berserker","\u{1F468}\u200D\u{1F33E}\u2694\uFE0F","Viking",5,2,4,"Furioso","F"],["Escudeiro Rural","\u{1F6E1}\uFE0F","Viking",0,3,1,"Protetor","P"],["Guardi\xE3o da Aldeia","\u{1F6E1}\uFE0F\u{1F33E}","Viking",3,5,4,"Protetor","P"],["Ca\xE7ador de Lobos","\u{1F3F9}","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Ferreiro Rural","\u{1F528}","Viking",4,6,5,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Chefe da Colheita","\u{1F451}\u{1F33E}","Viking",5,6,6,"Aliados +1 ATK","","BA1"]],animais:[["Urso Pardo","\u{1F43B}","Animal",6,6,5,"Protetor","P"],["Lobo Cinzento","\u{1F43A}","Animal",4,2,3,"Furioso","F"],["Javali Selvagem","\u{1F417}","Animal",3,2,2,"Impulsivo"],["Cervo Nobre","\u{1F98C}","Animal",4,5,4,"Resistente"],["Coruja S\xE1bia","\u{1F989}","Animal",1,2,1,"Entra: compre 1","","D1"],["Cavalo de Guerra","\u{1F434}","Animal",3,3,3,"Confi\xE1vel"],["Cabra da Montanha","\u{1F410}","Animal",2,3,2,"Protetor","P"],["\xC1guia do Norte","\u{1F985}","Animal",5,3,4,"Veloz"],["Urso Polar","\u{1F43B}\u200D\u2744\uFE0F","Animal",7,7,6,"Gigante"],["Serpente do Mar","\u{1F40D}","Animal",8,7,7,"Colosso"]],pescadores:[["Grumete do Fiorde","\u{1F466}\u{1F3A3}","Viking",1,1,1,"Aprendiz"],["Pescador do Fiorde","\u{1F9D4}\u200D\u2642\uFE0F\u{1F3A3}","Viking",2,3,2,"Veterano"],["Arpoador N\xF3rdico","\u{1FA9D}","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Curandeira do Sal","\u{1F9C2}\u2728","Viking",2,3,3,"Entra: cura 2","","H2"],["Vigia do Farol","\u{1F5FC}\u{1F6E1}\uFE0F","Viking",2,5,4,"Protetor","P"],["Ferreiro Naval","\u2693\uFE0F\u{1F528}","Viking",4,5,5,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Capit\xE3o da Pesca","\u{1F451}\u{1F3A3}","Viking",5,6,6,"Aliados +1 ATK","","BA1"],["Remador \xC1gil","\u{1F6A3}","Viking",4,2,3,"Furioso","F"]],floresta:[["Urso Negro","\u{1F43B}","Animal",5,5,5,"Protetor","P"],["Lobo da Mata","\u{1F43A}","Animal",4,2,3,"Furioso","F"],["Javali da Floresta","\u{1F417}","Animal",3,2,2,"Impulsivo"],["Cervo Vermelho","\u{1F98C}","Animal",4,5,4,"Resistente"],["Coruja S\xE1bia","\u{1F989}","Animal",1,2,1,"Entra: compre 1","","D1"],["Raposa \xC1gil","\u{1F98A}","Animal",3,3,3,"Veloz"],["Bisonte das Colinas","\u{1F402}","Animal",6,6,6,"Imponente"],["Serpente do Bosque","\u{1F40D}","Animal",5,4,4,"Silenciosa"]]},ce=["vikings","pescadores"],Te=["animais","floresta"],n={playerHP:30,aiHP:30,turn:1,playerMana:0,playerManaCap:0,playerHarvest:0,playerHarvestCap:0,aiMana:0,aiManaCap:0,aiHarvest:0,aiHarvestCap:0,current:"player",playerDeck:[],aiDeck:[],playerHand:[],aiHand:[],playerBoard:[],aiBoard:[],playerDiscard:[],aiDiscard:[],chosen:null,playerDeckChoice:"vikings",aiDeckChoice:"animais",customDeck:null},i={pHP:u("#playerHP"),pHP2:u("#playerHP2"),aHP:u("#aiHP"),aHP2:u("#aiHP2"),mana:u("#mana"),pHand:u("#playerHand"),pBoard:u("#playerBoard"),aBoard:u("#aiBoard"),endBtn:u("#endTurnBtn"),muteBtn:u("#muteBtn"),aAva:u("#aiAvatar"),drawCount:u("#drawCount"),discardCount:u("#discardCount"),barPHP:u("#barPlayerHP"),barAHP:u("#barAiHP"),barMana:u("#barMana"),start:u("#start"),openEncy:u("#openEncy"),ency:u("#ency"),encyGrid:u("#encyGrid"),encyFilters:u("#encyFilters"),closeEncy:u("#closeEncy"),startGame:u("#startGame"),endOverlay:u("#endOverlay"),endMsg:u("#endMsg"),endSub:u("#endSub"),playAgainBtn:u("#playAgainBtn"),rematchBtn:u("#rematchBtn"),menuBtn:u("#menuBtn")},_e=u("#pool"),Qe=u("#chosen"),Ze=u("#countDeck"),et=u("#curve");window.addEventListener("error",function(e){console.error("JS Error:",e.message,e.filename+":"+e.lineno);try{typeof y=="function"&&y("\u26A0\uFE0F "+e.message)}catch{}});window.addEventListener("unhandledrejection",function(e){console.error("Unhandled Rejection:",e.reason);try{let t=e.reason&&e.reason.message?e.reason.message:String(e.reason);typeof y=="function"&&y("\u26A0\uFE0F "+t)}catch{}});function z(e,t=!1){let s=e.offsetHeight,a=e.offsetWidth,o=!1;t?(e.addEventListener("mouseenter",()=>{o=!0,e.style.zIndex=1e3,e.style.transform="translateY(-20px)"}),e.addEventListener("mouseleave",()=>{o=!1,e.style.zIndex=e.dataset.z||"",e.style.transform=""})):e.addEventListener("mouseleave",()=>{e.style.transform=""}),e.addEventListener("mousemove",r=>{if(e.classList.contains("chosen"))return;let l=(r.offsetX/a-.5)*12,d=(r.offsetY/s-.5)*-12,c=o?-20:0;e.style.transform=`translateY(${c}px) perspective(600px) rotateX(${d}deg) rotateY(${l}deg)`})}function X(e,t){let s=document.createElement("div");s.className=`card ${t==="player"?"me":"enemy"} ${e.stance==="defense"?"defense":""}`,s.dataset.id=e.id;let a=`${e.cost}${e.harvestCost?`\u{1F33E}${e.harvestCost}`:""}`,o=(e.kw||[]).map(r=>`<span class='keyword' data-tip='${r==="Protetor"?"Enquanto houver Protetor ou carta em Defesa do lado do defensor, ataques devem mir\xE1-los.":r==="Furioso"?"Pode atacar no turno em que \xE9 jogada.":""}' >${r}</span>`);return e.subclasse&&e.classe&&o.push(`<span class='class-tag ${e.classe}'>${e.subclasse}</span>`),s.innerHTML=`<div class="bg bg-${e.deck||"default"}"></div><div class="head"><span class="cost">${a}</span><div class="name">${e.name}</div>${e.stance?`<span class="badge ${e.stance==="defense"?"def":"atk"}">${e.stance==="defense"?"\u{1F6E1}\uFE0F":"\u2694\uFE0F"}</span>`:""}</div><div class="tribe">${e.tribe}</div><div class="art">${e.emoji}</div><div class="text">${o.join(" ")} ${e.text||""}</div><div class="stats"><span class="gem atk">\u2694\uFE0F ${e.atk}</span>${e.stance?`<span class="stance-label ${e.stance}">${e.stance==="defense"?"\u{1F6E1}\uFE0F":"\u2694\uFE0F"}</span>`:""}<span class="gem hp ${e.hp<=2?"low":""}">\u2764\uFE0F ${e.hp}</span></div>`,s}function Y(e){e&&(e.stance=null,e.canAttack=!1,delete e.summonTurn)}var de=e=>e.some(t=>t.kw.includes("Protetor")||t.stance==="defense");function He(){let e=(t,s)=>s>0?Math.max(0,Math.min(100,t/s*100)):0;i.barPHP.style.width=e(n.playerHP,30)+"%",i.barAHP.style.width=e(n.aiHP,30)+"%",i.barMana.style.width=e(n.playerMana,n.playerManaCap)+"%"}function w(){i.pHP.textContent=n.playerHP,i.pHP2.textContent=n.playerHP,i.aHP.textContent=n.aiHP,i.aHP2.textContent=n.aiHP,i.mana.textContent=`${n.playerMana}/${n.playerManaCap} | \u{1F33E} ${n.playerHarvest}/${n.playerHarvestCap}`,i.endBtn.disabled=n.current!=="player",i.drawCount.textContent=n.playerDeck.length,i.discardCount.textContent=n.playerDiscard.length,He(),Pe(),Z()}function Pe(){i.pHand.innerHTML="",n.playerHand.forEach(e=>{let t=X(e,"player");t.classList.add("handcard"),z(t,!0),t.addEventListener("click",o=>{if(e.cost>n.playerMana||e.harvestCost>n.playerHarvest||n.current!=="player"||n.playerBoard.length>=5){t.style.transform="translateY(-2px)",setTimeout(()=>t.style.transform="",150),C("error");return}o.stopPropagation(),Le(t,e)});let s=e.cost>n.playerMana||e.harvestCost>n.playerHarvest,a=n.current!=="player"||n.playerBoard.length>=5;t.classList.toggle("blocked",s),t.style.opacity=s||a?.9:1,t.style.cursor=s||a?"not-allowed":"pointer",i.pHand.appendChild(t)}),Me()}function Me(){let e=R("#playerHand .card"),t=e.length;if(!t)return;let s=150,o=e[0].offsetWidth-s;i.pHand.style.setProperty("--hover-shift",`${o}px`),e.forEach((r,l)=>{let d=(l-(t-1)/2)*s;r.style.setProperty("--x",`${d}px`),r.dataset.z=String(l+1),r.style.zIndex=l+1})}function Z(){me(),i.pBoard.innerHTML="";for(let t of n.playerBoard){let s=X(t,"player");z(s),n.current==="player"&&t.canAttack&&t.stance!=="defense"&&(s.classList.add("selectable"),s.addEventListener("click",()=>Ve(t))),i.pBoard.appendChild(s)}i.aBoard.innerHTML="";for(let t of n.aiBoard){let s=X(t,"ai");z(s),n.chosen&&ye("ai",t)&&(s.classList.add("selectable"),s.addEventListener("click",()=>ke(n.chosen,t))),i.aBoard.appendChild(s)}let e=document.querySelector("#aiBoard .face-attack-btn");e||(e=document.createElement("button"),e.type="button",e.className="btn-ghost face-attack-btn",e.textContent="\u{1F5E1}\uFE0F Atacar diretamente",Object.assign(e.style,{position:"absolute",top:"8px",right:"8px",display:"none"}),e.addEventListener("click",()=>{n.chosen&&Ce(n.chosen,"ai")}),i.aBoard.appendChild(e)),he()}function Le(e,t){let s=e.getBoundingClientRect(),a=e.cloneNode(!0);e.style.visibility="hidden",a.classList.add("card-preview"),Object.assign(a.style,{position:"fixed",left:s.left+"px",top:s.top+"px",margin:"0",zIndex:1e3,transition:"left .3s ease, top .3s ease"}),document.body.appendChild(a),requestAnimationFrame(()=>{a.style.left=window.innerWidth/2-s.width/2+"px",a.style.top=window.innerHeight/2-s.height/2+"px"}),a.addEventListener("transitionend",function o(){a.removeEventListener("transitionend",o),$e(a,r=>{we(a,()=>De(t.id,r)),a.remove()},()=>{let r=e.getBoundingClientRect();a.style.left=r.left+"px",a.style.top=r.top+"px",a.addEventListener("transitionend",()=>{a.remove(),e.style.visibility=""},{once:!0})})},{once:!0})}function $e(e,t,s){j(),e.classList.add("chosen");let a=document.createElement("div");a.className="stance-chooser";let o=document.createElement("button");o.className="btn",o.textContent="\u2694\uFE0F Ataque";let r=document.createElement("button");r.className="btn",r.textContent="\u{1F6E1}\uFE0F Defesa",o.onclick=()=>{e.classList.remove("chosen"),j(),t("attack")},r.onclick=()=>{e.classList.remove("chosen"),j(),t("defense")},a.append(o,r),e.appendChild(a),Object.assign(a.style,{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)"}),setTimeout(()=>{let l=d=>{d.target.closest(".stance-chooser")||d.target===e||(window.removeEventListener("click",l,!0),e.classList.remove("chosen"),j(),s&&s())};window.addEventListener("click",l,!0),o.focus()},0)}var j=()=>{let e=document.querySelector(".stance-chooser");e&&e.remove(),document.querySelectorAll(".hand .card.chosen").forEach(t=>t.classList.remove("chosen"))};function we(e,t){let s=e.getBoundingClientRect(),a=e.cloneNode(!0);Object.assign(a.style,{left:s.left+"px",top:s.top+"px",width:s.width+"px",height:s.height+"px",position:"fixed",zIndex:999,transition:"transform .45s ease,opacity .45s ease"}),a.classList.add("fly"),document.body.appendChild(a);let o=i.pBoard.getBoundingClientRect();requestAnimationFrame(()=>{let r=o.left+o.width/2-s.left-s.width/2,l=o.top+10-s.top;a.style.transform=`translate(${r}px,${l}px) scale(.9)`,a.style.opacity="0"}),setTimeout(()=>{a.remove(),t&&t()},450)}function ee(){let e=t=>(t.hp<1&&(t.hp=1),t.atk<0&&(t.atk=0),t);n.playerDeck=n.playerDeckChoice==="custom"&&n.customDeck?ue(n.customDeck.slice()):q[n.playerDeckChoice].map(U),n.playerDeck.forEach(t=>{e(t),t.owner="player",t.deck=n.playerDeckChoice==="custom"?"custom":n.playerDeckChoice}),n.aiDeck=q[n.aiDeckChoice].map(U),n.aiDeck.forEach(t=>{e(t),t.owner="ai",t.deck=n.aiDeckChoice}),n.playerDiscard=[],n.aiDiscard=[],n.playerHand=[],n.aiHand=[],n.playerBoard=[],n.aiBoard=[],n.playerHP=30,n.aiHP=30,n.current="player",n.playerMana=0,n.playerManaCap=0,n.playerHarvest=0,n.playerHarvestCap=0,n.aiMana=0,n.aiManaCap=0,n.aiHarvest=0,n.aiHarvestCap=0,I("player",3),I("ai",3),J(),w(),O(),E("combat"),y("A batalha come\xE7ou!"),C("start")}var ue=e=>{for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e};function I(e,t=1){let s=e==="player"?n.playerDeck:n.aiDeck,a=e==="player"?n.playerHand:n.aiHand,o=e==="player"?n.playerDiscard:n.aiDiscard;for(let r=0;r<t;r++)if(s.length===0&&o.length&&(o.forEach(Y),s.push(...ue(o.splice(0)))),s.length){let l=s.shift();Y(l),l.hp<1&&(l.hp=1),a.push(l)}e==="player"&&(i.drawCount.textContent=n.playerDeck.length,i.discardCount.textContent=n.playerDiscard.length)}function J(){n.current==="player"?(n.playerManaCap=b(n.playerManaCap+1,0,10),n.playerMana=n.playerManaCap,n.playerHarvestCap=b(n.playerHarvestCap+1,0,10),n.playerHarvest=n.playerHarvestCap,I("player",1),n.playerBoard.forEach(e=>e.canAttack=!0)):(n.aiManaCap=b(n.aiManaCap+1,0,10),n.aiMana=n.aiManaCap,n.aiHarvestCap=b(n.aiHarvestCap+1,0,10),n.aiHarvest=n.aiHarvestCap,I("ai",1),n.aiBoard.forEach(e=>e.canAttack=!0)),w()}function Re(){n.current==="player"&&(n.current="ai",n.chosen=null,N(),J(),C("end"),setTimeout(()=>ie({G:n,summon:pe,renderAll:w,legalTarget:ye,attackCard:ke,attackFace:Ce,rand:D,newTurn:J}),500))}function De(e,t){if(n.current!=="player")return;let s=n.playerHand.findIndex(o=>o.id===e);if(s<0)return;let a=n.playerHand[s];a.cost>n.playerMana||a.harvestCost>n.playerHarvest||n.playerBoard.length>=5||(n.playerHand.splice(s,1),pe("player",a,t),n.playerMana-=a.cost,n.playerHarvest-=a.harvestCost,w(),C(t==="defense"?"defense":"play"))}function pe(e,t,s="attack"){let a=e==="player"?n.playerBoard:n.aiBoard;t.stance=s,t.canAttack=s==="attack"&&t.kw.includes("Furioso"),a.push(t),y(`${e==="player"?"Voc\xEA":"Inimigo"} jogou ${t.name} em modo ${s==="defense"?"defesa":"ataque"}.`),Se(e,t),s==="defense"&&setTimeout(()=>te(t.id),30)}function Se(e,t){let s=e==="player"?"ai":"player";switch(t.battlecry){case"draw1":I(e,1),y(`${t.name}: comprou 1 carta.`);break;case"heal2":{let a=e==="player"?n.playerBoard:n.aiBoard;if(a.length){let o=D(a);o.hp=Math.min(o.hp+2,20),W(o.id,"+2","heal");let r=H(o.id);if(r){let l=r.getBoundingClientRect();ae("healing",l.left+l.width/2,l.top+l.height/2)}y(`${t.name}: curou 2 em ${o.name}.`)}}break;case"ping1":{let a=s==="ai"?n.aiBoard:n.playerBoard;if(a.length){let o=D(a);Q(o,1),S(o.id,"attack"),W(o.id,"-1","dmg"),y(`${t.name}: 1 de dano em ${o.name}.`),ne(),w(),C("hit")}}break;case"buffRandom1":{let a=(e==="player"?n.playerBoard:n.aiBoard).filter(o=>o.id!==t.id);if(a.length){let o=D(a);o.atk+=1,o.hp+=1,W(o.id,"+1/+1","buff"),S(o.id,"magic"),y(`${t.name}: deu +1/+1 em ${o.name}.`)}}break;case"buffAlliesAtk1":{let a=(e==="player"?n.playerBoard:n.aiBoard).filter(o=>o.id!==t.id);a.forEach(o=>{o.atk+=1,W(o.id,"+1 ATK","buff"),S(o.id,"magic")}),a.length&&y(`${t.name}: aliados ganharam +1 de ataque.`)}break}}function N(){document.body.classList.toggle("targeting",!!n.chosen)}function me(){if(!n.chosen)return!1;if(n.current!=="player")return n.chosen=null,document.body.classList.remove("targeting"),!1;let e=n.playerBoard.find(t=>t.id===n.chosen.id);return!e||!e.canAttack||e.stance==="defense"?(n.chosen=null,document.body.classList.remove("targeting"),!1):(n.chosen=e,!0)}function fe(){n.chosen&&(n.chosen=null,N(),i.aBoard.classList.remove("face-can-attack"),Z())}function Ve(e){n.current!=="player"||!e.canAttack||e.stance==="defense"||(n.chosen=e,N(),Z(),he(),n.aiBoard.filter(t=>t.stance==="defense").forEach(t=>setTimeout(()=>te(t.id),20)))}function he(){let e=de(n.aiBoard),s=me()&&!e,a=document.querySelector("#aiBoard .face-attack-btn");s?(i.aBoard.classList.add("face-can-attack"),a&&(a.style.display="block")):(i.aBoard.classList.remove("face-can-attack"),a&&(a.style.display="none"))}function ye(e,t){let s=e==="ai"?n.aiBoard:n.playerBoard;return de(s)?t.kw.includes("Protetor")||t.stance==="defense":!0}var H=e=>document.querySelector(`.card[data-id="${e}"]`),_=(e,t,s=400)=>{e&&e.classList.add(t),setTimeout(()=>e&&e.classList.remove(t),s)},ve=(e,t)=>{let s=H(e),a=t?H(t):null;_(s,"attack-lunge",350),a&&_(a,"hit-shake",350)},te=e=>{let t=H(e);_(t,"shield-flash",600)};function ge(e,t,s){let a=document.createElement("div");a.className="fx fx-slash",a.style.left=e+"px",a.style.top=t+"px",a.style.setProperty("--ang",s+"deg"),document.body.appendChild(a),setTimeout(()=>a.remove(),380)}function ae(e,t,s){let a=document.createElement("div");a.className="fx fx-"+e,a.style.left=t+"px",a.style.top=s+"px",document.body.appendChild(a),setTimeout(()=>a.remove(),600)}function S(e,t){let s=H(e);if(!s)return;let a=s.getBoundingClientRect();ae(t,a.left+a.width/2,a.top+a.height/2)}function Oe(e,t){let s=e==="ai"?i.aHP2:i.pHP2;if(!s)return;let a=s.getBoundingClientRect();ae(t,a.left+a.width/2,a.top+a.height/2)}function W(e,t,s){let a=document.querySelector(`.card[data-id="${e}"]`);if(!a)return;let o=a.getBoundingClientRect(),r=document.createElement("div");r.className="fx-float "+(s||""),r.textContent=t,r.style.left=o.left+o.width/2+"px",r.style.top=o.top+o.height/2+"px",document.body.appendChild(r),setTimeout(()=>r.remove(),950)}function ke(e,t){if(!e||!e.canAttack||e.stance==="defense")return;C("attack");let s=H(e.id),a=H(t.id);if(s&&a){let l=s.getBoundingClientRect(),d=a.getBoundingClientRect();ge(l.right,l.top+l.height/2,15)}ve(e.id,t.id),t.stance==="defense"&&te(t.id),S(t.id,"attack");let o=t.hp,r=Math.max(0,e.atk-o);Q(t,e.atk),Q(e,t.atk),C("hit"),r>0&&t.hp<=0&&(n.playerBoard.includes(e)?(n.aiHP=b(n.aiHP-r,0,99),y(`${e.name} excedeu em ${r} e causou dano direto ao Inimigo!`)):(n.playerHP=b(n.playerHP-r,0,99),y(`${e.name} excedeu em ${r} e causou dano direto a Voc\xEA!`)),be()),e.canAttack=!1,y(`${e.name} atacou ${t.name}.`),ne(),w(),n.chosen=null,N(),i.aBoard.classList.remove("face-can-attack")}function Ce(e,t){if(!e||!e.canAttack||e.stance==="defense")return;C("attack");let s=H(e.id);if(s){let o=s.getBoundingClientRect();ge(o.right,o.top+o.height/2,10)}ve(e.id,null),Oe(t,"attack");let a=e.atk;e.canAttack=!1,t==="ai"?(n.aiHP=b(n.aiHP-a,0,99),y(`${e.name} causou ${a} ao Inimigo!`),C("crit")):(n.playerHP=b(n.playerHP-a,0,99),y(`${e.name} causou ${a} a Voc\xEA!`),C("hit")),be(),n.chosen=null,N(),i.aBoard.classList.remove("face-can-attack"),w()}function Q(e,t){!e||typeof t!="number"||(e.hp=b(e.hp-t,0,99),e.hp<=0&&setTimeout(ne,10))}function ne(){let e=n.aiBoard.filter(s=>s.hp<=0);e.forEach(s=>{S(s.id,"explosion"),Y(s)}),e.length&&(n.aiBoard=n.aiBoard.filter(s=>s.hp>0),n.aiDiscard.push(...e),y("Uma criatura inimiga caiu."));let t=n.playerBoard.filter(s=>s.hp<=0);t.forEach(s=>{S(s.id,"explosion"),Y(s)}),t.length&&(n.playerBoard=n.playerBoard.filter(s=>s.hp>0),n.playerDiscard.push(...t),y("Sua criatura caiu.")),i.discardCount.textContent=n.playerDiscard.length}function qe(e){let t=document.createElement("div");t.className="boom",t.style.left="50%",t.style.top="50%",t.style.background=`radial-gradient(circle at 50% 50%, ${e?"#8bf5a2":"#ff8a8a"}, transparent)`,document.body.appendChild(t),setTimeout(()=>t.remove(),650)}function le(e){O(),i.endMsg.textContent=e?"You WIN!":"You Lose...",i.endMsg.style.color=e?"#8bf5a2":"#ff8a8a",i.endSub.textContent=e?"Parab\xE9ns! Quer continuar jogando?":"Tentar de novo ou voltar ao menu.",i.endOverlay.classList.add("show"),setTimeout(()=>qe(e),1e3)}function be(){n.aiHP<=0&&le(!0),n.playerHP<=0&&le(!1)}function Ie(){let e=[];for(let t of Object.keys(q))for(let s of q[t]){let a=U(s);a.deck=t,e.push(a)}return e}function se(e="all",t=!1){i.encyGrid.innerHTML="",(e==="all"?Ie():q[e].map(U).map(a=>Object.assign(a,{deck:e}))).forEach(a=>{let o=document.createElement("div");o.className=`card ency-card bg-${a.deck}`,o.innerHTML=`<div class='bg bg-${a.deck}'></div><div class='head'><span class='cost'>${a.cost}${a.harvestCost?`\u{1F33E}${a.harvestCost}`:""}</span><div class='name'>${a.name}</div></div><div class='mini'>${a.tribe} \u2022 \u2694\uFE0F ${a.atk} / \u2764\uFE0F ${a.hp}</div><div class='art'>${a.emoji}</div><div class='details'><div>${(a.kw||[]).map(r=>`<span class='chip' data-type='keyword' data-tip='${r==="Protetor"?"Enquanto houver Protetor ou carta em Defesa do lado do defensor, ataques devem mir\xE1-los.":r==="Furioso"?"Pode atacar no turno em que \xE9 jogada.":""}' >${r}</span>`).join(" ")}</div><div style='margin-top:6px'>${a.text||""}</div></div>`,z(o),i.encyGrid.appendChild(o)}),i.ency.classList.add("show"),i.encyFilters.style.display=t?"none":"flex",R(".filters .fbtn").forEach(a=>a.classList.toggle("active",a.dataset.deck===e||e==="all"&&a.dataset.deck==="all"))}i.endBtn.addEventListener("click",Re);i.muteBtn.addEventListener("click",()=>{$(),A(),re(i.muteBtn)});window.addEventListener("keydown",e=>{e.key==="Escape"&&fe()});document.addEventListener("click",e=>{n.chosen&&(e.target.closest("#aiBoard .card.selectable")||e.target.closest("#playerBoard .card.selectable")||e.target.closest("#aiBoard .face-attack-btn")||fe())},{capture:!0});R(".deckbtn").forEach(e=>{e.addEventListener("pointermove",s=>{let a=e.getBoundingClientRect();e.style.setProperty("--px",(s.clientX-a.left)/a.width*100+"%"),e.style.setProperty("--py",(s.clientY-a.top)/a.height*100+"%")}),e.addEventListener("mouseenter",()=>{e.style.setProperty("--halo",.7),e.style.setProperty("--shine",.7)}),e.addEventListener("mouseleave",()=>{e.style.removeProperty("--halo"),e.style.removeProperty("--shine")}),e.addEventListener("click",()=>{let s=e.dataset.deck;n.playerDeckChoice=s,ce.includes(s)?n.aiDeckChoice=D(Te):n.aiDeckChoice=D(ce),E(s),R(".deckbtn").forEach(a=>a.style.outline="none"),e.style.outline="2px solid var(--accent)"});let t=e.querySelector(".view-cards");t&&t.addEventListener("click",s=>{s.stopPropagation(),se(e.dataset.deck,!0)})});i.startGame.addEventListener("click",()=>{i.start.style.display="none",$(),A(),O(),ee()});i.openEncy.addEventListener("click",()=>se("all",!1));i.closeEncy.addEventListener("click",()=>{i.ency.classList.remove("show")});R(".filters .fbtn").forEach(e=>e.addEventListener("click",()=>{se(e.dataset.deck,!1)}));i.playAgainBtn.addEventListener("click",()=>{i.endOverlay.classList.remove("show"),ee()});i.rematchBtn.addEventListener("click",()=>{i.endOverlay.classList.remove("show"),ee()});i.menuBtn.addEventListener("click",()=>{i.endOverlay.classList.remove("show"),i.start.style.display="grid",E("menu")});document.addEventListener("DOMContentLoaded",K);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&K()});window.addEventListener("pointerdown",()=>{$(),A(),E("menu")},{once:!0});})();
