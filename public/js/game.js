(()=>{var u=e=>document.querySelector(e),D=e=>Array.from(document.querySelectorAll(e));function y(e){let t=document.querySelector("#log");if(!t)return;let s=document.createElement("div");s.textContent=e,t.prepend(s)}var U=window.AudioContext||window.webkitAudioContext,p=null,L=null,B=!1;function w(){U&&(p||(p=new U,L=p.createGain(),L.gain.value=.18,L.connect(p.destination)))}function P(){p&&p.state==="suspended"&&p.resume()}function g(e=440,t=.1,s="sine",a=1,o=0){if(!p||B)return;P();let i=p.createOscillator(),d=p.createGain();i.type=s,i.frequency.setValueAtTime(e,p.currentTime+o),d.gain.setValueAtTime(1e-4,p.currentTime+o),d.gain.exponentialRampToValueAtTime(Math.max(2e-4,a),p.currentTime+o+.01),d.gain.exponentialRampToValueAtTime(1e-4,p.currentTime+o+t),i.connect(d),d.connect(L),i.start(p.currentTime+o),i.stop(p.currentTime+o+t+.02)}function k(e){!p||B||({start:()=>{g(520,.08,"triangle",.7,0),g(780,.09,"triangle",.6,.08)},play:()=>{g(420,.07,"sine",.7,0),g(560,.08,"sine",.6,.06)},defense:()=>{g(280,.09,"square",.6,0),g(200,.12,"sine",.5,.08)},attack:()=>{g(300,.06,"sawtooth",.7,0),g(220,.06,"sawtooth",.6,.05)},hit:()=>{g(160,.07,"square",.6,0)},overflow:()=>{g(600,.1,"triangle",.6,0)},death:()=>{g(420,.08,"sawtooth",.6,0),g(260,.12,"sawtooth",.55,.06)},end:()=>{g(600,.06,"triangle",.6,0),g(400,.06,"triangle",.5,.05)},crit:()=>{g(120,.08,"square",.75,0),g(90,.12,"square",.7,.06)},error:()=>{g(140,.05,"square",.6,0),g(140,.05,"square",.6,.06)}}[e]||(()=>{}))()}var C=null,z=null,E=!1,$="menu",re={menu:{bpm:84,leadBase:196,bassBase:98,leadWave:"triangle",bassWave:"sine",scale:[0,3,5,7,5,3,0,-5]},vikings:{bpm:76,leadBase:174.61,bassBase:87.31,leadWave:"sawtooth",bassWave:"sine",scale:[0,3,5,7,10,7,5,3]},animais:{bpm:90,leadBase:220,bassBase:110,leadWave:"square",bassWave:"sine",scale:[0,2,5,7,9,7,5,2]},pescadores:{bpm:96,leadBase:196,bassBase:98,leadWave:"triangle",bassWave:"triangle",scale:[0,2,4,7,9,7,4,2]},floresta:{bpm:68,leadBase:207.65,bassBase:103.83,leadWave:"sine",bassWave:"sine",scale:[0,3,5,10,5,3,0,-2]},combat:{bpm:118,leadBase:220,bassBase:110,leadWave:"sawtooth",bassWave:"square",scale:[0,2,3,5,7,8,7,5],perc:!0,ac:4}};function A(e){if(!U||B||(w(),P(),e&&e!==$&&E&&N(),$=e||$||"menu",E))return;E=!0;let t=re[$]||re.menu;C=p.createGain(),C.gain.value=1e-4,C.connect(L);let s=$==="combat"?.22:.18;C.gain.exponentialRampToValueAtTime(s,p.currentTime+.4);let a=60/t.bpm,o=t.scale.length,i=()=>{if(!E||!C)return;let l=p.currentTime;for(let c=0;c<o;c++){let h=t.leadBase*Math.pow(2,t.scale[c]/12),f=p.createOscillator(),v=p.createGain();f.type=t.leadWave,f.frequency.setValueAtTime(h,l+c*a),v.gain.setValueAtTime(1e-4,l+c*a),v.gain.exponentialRampToValueAtTime($==="combat"?.13:.11,l+c*a+.01),v.gain.exponentialRampToValueAtTime(1e-4,l+c*a+a*.92),f.connect(v),v.connect(C),f.start(l+c*a),f.stop(l+c*a+a)}for(let c=0;c<o;c+=2){let h=p.createOscillator(),f=p.createGain();h.type=t.bassWave,h.frequency.setValueAtTime(t.bassBase,l+c*a),f.gain.setValueAtTime(1e-4,l+c*a),f.gain.exponentialRampToValueAtTime($==="combat"?.1:.09,l+c*a+.01),f.gain.exponentialRampToValueAtTime(1e-4,l+c*a+a*.96),h.connect(f),f.connect(C),h.start(l+c*a),h.stop(l+c*a+a)}if(t.perc)for(let c=0;c<o;c++){let h=p.createOscillator(),f=p.createGain();if(h.type="square",h.frequency.setValueAtTime(1600,l+c*a),f.gain.setValueAtTime(1e-4,l+c*a),f.gain.exponentialRampToValueAtTime(.07,l+c*a+.005),f.gain.exponentialRampToValueAtTime(1e-4,l+c*a+a*.2),h.connect(f),f.connect(C),h.start(l+c*a),h.stop(l+c*a+a*.2),t.ac&&c%t.ac===0){let v=p.createOscillator(),m=p.createGain();v.type="sine",v.frequency.setValueAtTime(120,l+c*a),m.gain.setValueAtTime(1e-4,l+c*a),m.gain.exponentialRampToValueAtTime(.12,l+c*a+.01),m.gain.exponentialRampToValueAtTime(1e-4,l+c*a+a*.3),v.connect(m),m.connect(C),v.start(l+c*a),v.stop(l+c*a+a*.3)}}};i();let d=a*o*1e3;z=setInterval(i,d-25)}function N(){if(E&&(E=!1,z&&(clearInterval(z),z=null),C)){try{C.gain.exponentialRampToValueAtTime(1e-4,p.currentTime+.25)}catch{}setTimeout(()=>{try{C.disconnect()}catch{}C=null},300)}}function J(){if(U){w();try{P()}catch{}try{A("menu")}catch{}if(p&&p.state!=="running")try{p.resume().then(()=>A("menu")).catch(()=>{})}catch{}if(!E){let e=0,t=setInterval(()=>{if(e++,E||e>8){clearInterval(t);return}try{w(),P(),A("menu")}catch{}},800)}}}function ce(e){B=!B,L&&(L.gain.value=B?0:.18),C&&(C.gain.value=B?0:.18),e&&(e.textContent=B?"\u{1F507} Mudo":"\u{1F50A} Som")}function le(e){let{G:t,summon:s,renderAll:a,legalTarget:o,attackCard:i,attackFace:d,rand:l,newTurn:c}=e,h=t.aiHand.filter(m=>m.cost<=t.aiMana&&m.harvestCost<=t.aiHarvest).sort((m,M)=>M.cost-m.cost);for(;h.length&&t.aiBoard.length<5&&t.aiMana>0;){let m=h.shift(),M=t.aiHand.findIndex(O=>O.id===m.id);if(M>-1&&m.cost<=t.aiMana&&m.harvestCost<=t.aiHarvest){t.aiHand.splice(M,1);let O=m.hp>=m.atk+1?Math.random()<.7?"defense":"attack":Math.random()<.3?"defense":"attack";s("ai",m,O),t.aiMana-=m.cost,t.aiHarvest-=m.harvestCost}}a();let f=t.aiBoard.filter(m=>m.canAttack&&m.stance!=="defense");function v(){if(!f.length){t.current="player",c();return}let m=f.shift(),M=t.playerBoard.filter(O=>o("player",O));M.length?i(m,l(M)):d(m,"player"),setTimeout(v,500)}setTimeout(v,500)}var Ye=Object.freeze({MANA:"mana",ENERGIA:"energia",COLHEITA:"colheita"}),T=Object.freeze({FURIOSO:"Furioso",PROTETOR:"Protetor",PERCEPCAO:"Percep\xE7\xE3o",CURA:"Cura",BENCAO:"B\xEAn\xE7\xE3o",CORVO:"Corvo",SERPENTE:"Serpente"}),Ke=Object.freeze({UNIDADE:"Unidade",RITUAL:"Ritual",LENDA_MITICA:"Lenda M\xEDtica"}),Xe=Object.freeze({VIKINGS:"Vikings",FLORESTA:"Floresta",SOMBRAS:"Sombras",RUNICO:"R\xFAnico",MITICO:"M\xEDtico"});var V=e=>e[Math.floor(Math.random()*e.length)],b=(e,t,s)=>Math.max(t,Math.min(s,e)),Te=()=>Math.random().toString(36).slice(2),H=null,q=null,He={P:T.PROTETOR,F:T.FURIOSO,PE:T.PERCEPCAO,C:T.CURA,B:T.BENCAO,CV:T.CORVO,S:T.SERPENTE},Me={D1:"draw1",H2:"heal2",P1:"ping1",BR1:"buffRandom1",BA1:"buffAlliesAtk1"};function $e(e){let t=e.toLowerCase();return t.includes("berserker")?{classe:"tank",subclasse:"Berserker"}:t.includes("guardi\xE3o do v\xE9u")||t.includes("v\xE9u")?{classe:"control",subclasse:"Guardi\xE3o do V\xE9u"}:t.includes("guardi\xE3o")?{classe:"tank",subclasse:"Guardi\xE3o"}:t.includes("uivante")?{classe:"tank",subclasse:"Uivante"}:t.includes("ca\xE7ador")?{classe:"dps",subclasse:"Ca\xE7ador"}:t.includes("runomante")?{classe:"dps",subclasse:"Runomante"}:t.includes("serpente")?{classe:"dps",subclasse:"Serpente"}:t.includes("curandeir")?{classe:"support",subclasse:"Curandeiro"}:t.includes("tot\xEAmico")||t.includes("totemico")?{classe:"support",subclasse:"Tot\xEAmico"}:t.includes("sacerdote")||t.includes("tecel\xE3o")?{classe:"support",subclasse:"Tecel\xE3o"}:t.includes("xam\xE3")?{classe:"control",subclasse:"Xam\xE3"}:t.includes("corvo")?{classe:"control",subclasse:"Corvo"}:t.includes("guerreiro")?{classe:"dps",subclasse:"Guerreiro"}:t.includes("raider")?{classe:"dps",subclasse:"Raider"}:t.includes("batalhador")?{classe:"dps",subclasse:"Batalhador"}:t.includes("mago")||t.includes("mistico")?{classe:"support",subclasse:"Mago"}:t.includes("sombras")||t.includes("encapuzado")?{classe:"control",subclasse:"Sombras"}:t.includes("navegador")?{classe:"support",subclasse:"Navegador"}:{classe:"",subclasse:""}}var K=e=>{let[t,s,a,o,i,d,l,c=0,h=0,f=0]=e,v=$e(t||"");return{name:t,emoji:s,tribe:a,atk:o,hp:i,cost:d,harvestCost:f,text:l,kw:c?c.split("|").map(m=>He[m]):[],battlecry:h?Me[h]:void 0,classe:v.classe,subclasse:v.subclasse,id:Te()}},I={vikings:[["Lavrador de Lan\xE7a","\u{1F9D4}\u200D\u{1F33E}","Viking",2,2,2,"Disciplinado"],["Camponesa Curandeira","\u{1F469}\u200D\u{1F33E}\u2728","Viking",2,3,3,"Entra: cura 2","","H2"],["Ceifeiro Berserker","\u{1F468}\u200D\u{1F33E}\u2694\uFE0F","Viking",5,2,4,"Furioso","F"],["Escudeiro Rural","\u{1F6E1}\uFE0F","Viking",0,3,1,"Protetor","P"],["Guardi\xE3o da Aldeia","\u{1F6E1}\uFE0F\u{1F33E}","Viking",3,5,4,"Protetor","P"],["Ca\xE7ador de Lobos","\u{1F3F9}","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Ferreiro Rural","\u{1F528}","Viking",4,6,5,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Chefe da Colheita","\u{1F451}\u{1F33E}","Viking",5,6,6,"Aliados +1 ATK","","BA1"]],animais:[["Urso Pardo","\u{1F43B}","Animal",6,6,5,"Protetor","P"],["Lobo Cinzento","\u{1F43A}","Animal",4,2,3,"Furioso","F"],["Javali Selvagem","\u{1F417}","Animal",3,2,2,"Impulsivo"],["Cervo Nobre","\u{1F98C}","Animal",4,5,4,"Resistente"],["Coruja S\xE1bia","\u{1F989}","Animal",1,2,1,"Entra: compre 1","","D1"],["Cavalo de Guerra","\u{1F434}","Animal",3,3,3,"Confi\xE1vel"],["Cabra da Montanha","\u{1F410}","Animal",2,3,2,"Protetor","P"],["\xC1guia do Norte","\u{1F985}","Animal",5,3,4,"Veloz"],["Urso Polar","\u{1F43B}\u200D\u2744\uFE0F","Animal",7,7,6,"Gigante"],["Serpente do Mar","\u{1F40D}","Animal",8,7,7,"Colosso"]],pescadores:[["Grumete do Fiorde","\u{1F466}\u{1F3A3}","Viking",1,1,1,"Aprendiz"],["Pescador do Fiorde","\u{1F9D4}\u200D\u2642\uFE0F\u{1F3A3}","Viking",2,3,2,"Veterano"],["Arpoador N\xF3rdico","\u{1FA9D}","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Curandeira do Sal","\u{1F9C2}\u2728","Viking",2,3,3,"Entra: cura 2","","H2"],["Vigia do Farol","\u{1F5FC}\u{1F6E1}\uFE0F","Viking",2,5,4,"Protetor","P"],["Ferreiro Naval","\u2693\uFE0F\u{1F528}","Viking",4,5,5,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Capit\xE3o da Pesca","\u{1F451}\u{1F3A3}","Viking",5,6,6,"Aliados +1 ATK","","BA1"],["Remador \xC1gil","\u{1F6A3}","Viking",4,2,3,"Furioso","F"]],floresta:[["Urso Negro","\u{1F43B}","Animal",5,5,5,"Protetor","P"],["Lobo da Mata","\u{1F43A}","Animal",4,2,3,"Furioso","F"],["Javali da Floresta","\u{1F417}","Animal",3,2,2,"Impulsivo"],["Cervo Vermelho","\u{1F98C}","Animal",4,5,4,"Resistente"],["Coruja S\xE1bia","\u{1F989}","Animal",1,2,1,"Entra: compre 1","","D1"],["Raposa \xC1gil","\u{1F98A}","Animal",3,3,3,"Veloz"],["Bisonte das Colinas","\u{1F402}","Animal",6,6,6,"Imponente"],["Serpente do Bosque","\u{1F40D}","Animal",5,4,4,"Silenciosa"]]},de=["vikings","pescadores"],Le=["animais","floresta"],n={playerHP:30,aiHP:30,turn:1,playerMana:0,playerManaCap:0,playerHarvest:0,playerHarvestCap:0,aiMana:0,aiManaCap:0,aiHarvest:0,aiHarvestCap:0,current:"player",playerDeck:[],aiDeck:[],playerHand:[],aiHand:[],playerBoard:[],aiBoard:[],playerDiscard:[],aiDiscard:[],chosen:null,playerDeckChoice:"vikings",aiDeckChoice:"animais",customDeck:null},r={pHP:u("#playerHP"),pHP2:u("#playerHP2"),aHP:u("#aiHP"),aHP2:u("#aiHP2"),mana:u("#mana"),pHand:u("#playerHand"),pBoard:u("#playerBoard"),aBoard:u("#aiBoard"),drawPile:u("#drawPile"),discardPile:u("#discardPile"),aiDrawPile:u("#aiDrawPile"),aiDiscardPile:u("#aiDiscardPile"),endBtn:u("#endTurnBtn"),muteBtn:u("#muteBtn"),aAva:u("#aiAvatar"),drawCount:u("#drawCount"),discardCount:u("#discardCount"),barPHP:u("#barPlayerHP"),barAHP:u("#barAiHP"),barMana:u("#barMana"),start:u("#start"),openEncy:u("#openEncy"),ency:u("#ency"),encyGrid:u("#encyGrid"),encyFilters:u("#encyFilters"),closeEncy:u("#closeEncy"),startGame:u("#startGame"),endOverlay:u("#endOverlay"),endMsg:u("#endMsg"),endSub:u("#endSub"),playAgainBtn:u("#playAgainBtn"),rematchBtn:u("#rematchBtn"),menuBtn:u("#menuBtn")},tt=u("#pool"),at=u("#chosen"),nt=u("#countDeck"),st=u("#curve");window.addEventListener("error",function(e){console.error("JS Error:",e.message,e.filename+":"+e.lineno);try{typeof y=="function"&&y("\u26A0\uFE0F "+e.message)}catch{}});window.addEventListener("unhandledrejection",function(e){console.error("Unhandled Rejection:",e.reason);try{let t=e.reason&&e.reason.message?e.reason.message:String(e.reason);typeof y=="function"&&y("\u26A0\uFE0F "+t)}catch{}});function F(e,t=!1){let s=e.offsetHeight,a=e.offsetWidth,o=!1;t?(e.addEventListener("mouseenter",()=>{o=!0,e.style.zIndex=1e3,e.style.transform="translateY(-20px)"}),e.addEventListener("mouseleave",()=>{o=!1,e.style.zIndex=e.dataset.z||"",e.style.transform=""})):e.addEventListener("mouseleave",()=>{e.style.transform=""}),e.addEventListener("mousemove",i=>{if(e.classList.contains("chosen")||e.classList.contains("no-tilt"))return;let d=(i.offsetX/a-.5)*12,l=(i.offsetY/s-.5)*-12,c=o?-20:0;e.style.transform=`translateY(${c}px) perspective(600px) rotateX(${l}deg) rotateY(${d}deg)`})}function _(e,t){let s=document.createElement("div");s.className=`card ${t==="player"?"me":"enemy"} ${e.stance==="defense"?"defense":""}`,s.dataset.id=e.id;let a=`${e.cost}${e.harvestCost?`\u{1F33E}${e.harvestCost}`:""}`,o=(e.kw||[]).map(i=>`<span class='keyword' data-tip='${i==="Protetor"?"Enquanto houver Protetor ou carta em Defesa do lado do defensor, ataques devem mir\xE1-los.":i==="Furioso"?"Pode atacar no turno em que \xE9 jogada.":""}' >${i}</span>`);return e.subclasse&&e.classe&&o.push(`<span class='class-tag ${e.classe}'>${e.subclasse}</span>`),s.innerHTML=`<div class="bg bg-${e.deck||"default"}"></div><div class="head"><span class="cost">${a}</span><div class="name">${e.name}</div>${e.stance?`<span class="badge ${e.stance==="defense"?"def":"atk"}">${e.stance==="defense"?"\u{1F6E1}\uFE0F":"\u2694\uFE0F"}</span>`:""}</div><div class="tribe">${e.tribe}</div><div class="art">${e.emoji}</div><div class="text">${o.join(" ")} ${e.text||""}</div><div class="stats"><span class="gem atk">\u2694\uFE0F ${e.atk}</span>${e.stance?`<span class="stance-label ${e.stance}">${e.stance==="defense"?"\u{1F6E1}\uFE0F":"\u2694\uFE0F"}</span>`:""}<span class="gem hp ${e.hp<=2?"low":""}">\u2764\uFE0F ${e.hp}</span></div>`,s}function X(e){e&&(e.stance=null,e.canAttack=!1,delete e.summonTurn)}var fe=e=>e.some(t=>t.kw.includes("Protetor")||t.stance==="defense");function we(){let e=(t,s)=>s>0?Math.max(0,Math.min(100,t/s*100)):0;r.barPHP.style.width=e(n.playerHP,30)+"%",r.barAHP.style.width=e(n.aiHP,30)+"%",r.barMana.style.width=e(n.playerMana,n.playerManaCap)+"%"}function R(){r.pHP.textContent=n.playerHP,r.pHP2.textContent=n.playerHP,r.aHP.textContent=n.aiHP,r.aHP2.textContent=n.aiHP,r.mana.textContent=`${n.playerMana}/${n.playerManaCap} | \u{1F33E} ${n.playerHarvest}/${n.playerHarvestCap}`,r.endBtn.disabled=n.current!=="player",r.drawCount.textContent=n.playerDeck.length,r.discardCount.textContent=n.playerDiscard.length,we(),he(),te()}function he(){r.pHand.innerHTML="",n.playerHand.forEach(e=>{let t=_(e,"player");t.classList.add("handcard"),F(t,!0),t.addEventListener("click",o=>{if(e.cost>n.playerMana||e.harvestCost>n.playerHarvest||n.current!=="player"||n.playerBoard.length>=5){t.style.transform="translateY(-2px)",setTimeout(()=>t.style.transform="",150),k("error");return}o.stopPropagation(),De(e,t)});let s=e.cost>n.playerMana||e.harvestCost>n.playerHarvest,a=n.current!=="player"||n.playerBoard.length>=5;t.classList.toggle("blocked",s),t.style.opacity=s||a?.9:1,t.style.cursor=s||a?"not-allowed":"pointer",r.pHand.appendChild(t)}),Re()}function Re(){let e=D("#playerHand .card"),t=e.length;if(!t)return;let s=150,o=e[0].offsetWidth-s;r.pHand.style.setProperty("--hover-shift",`${o}px`),e.forEach((i,d)=>{let l=(d-(t-1)/2)*s;i.style.setProperty("--x",`${l}px`),i.dataset.z=String(d+1),i.style.zIndex=d+1})}function te(){ve(),r.pBoard.innerHTML="";for(let t of n.playerBoard){let s=_(t,"player");F(s),n.current==="player"&&t.canAttack&&t.stance!=="defense"&&(s.classList.add("selectable"),s.addEventListener("click",()=>Ie(t))),r.pBoard.appendChild(s)}r.aBoard.innerHTML="";for(let t of n.aiBoard){let s=_(t,"ai");F(s),n.chosen&&be("ai",t)&&(s.classList.add("selectable"),s.addEventListener("click",()=>Ee(n.chosen,t))),r.aBoard.appendChild(s)}let e=document.querySelector("#aiBoard .face-attack-btn");if(e||(e=document.createElement("button"),e.type="button",e.className="btn-ghost face-attack-btn",e.textContent="\u{1F5E1}\uFE0F Atacar diretamente",Object.assign(e.style,{position:"absolute",top:"8px",right:"8px",display:"none"}),e.addEventListener("click",()=>{n.chosen&&Ae(n.chosen,"ai")}),r.aBoard.appendChild(e)),ke(),n.chosen){let t=x(n.chosen.id);t&&qe(t)}else W()}function De(e,t){let s=document.createElement("div");s.className="card-modal";let a=t.cloneNode(!0);F(a);let o=document.createElement("div");o.className="actions";let i=document.createElement("button");i.className="btn",i.textContent="\u2694\uFE0F Ataque";let d=document.createElement("button");d.className="btn",d.textContent="\u{1F6E1}\uFE0F Defesa";let l=document.createElement("button");l.className="btn-ghost",l.textContent="Cancelar",o.append(i,d,l),s.append(a,o),document.body.appendChild(s),t.classList.add("no-tilt"),t.style.visibility="hidden";let c=()=>{s.remove(),t.style.visibility="",t.classList.remove("no-tilt")};l.onclick=c,i.onclick=()=>{c(),ue(t,()=>pe(e.id,"attack"))},d.onclick=()=>{c(),ue(t,()=>pe(e.id,"defense"))}}function ue(e,t){let s=e.getBoundingClientRect(),a=e.cloneNode(!0);Object.assign(a.style,{left:s.left+"px",top:s.top+"px",width:s.width+"px",height:s.height+"px",position:"fixed",zIndex:999,transition:"transform .45s ease,opacity .45s ease"}),a.classList.add("fly"),document.body.appendChild(a);let o=r.pBoard.getBoundingClientRect();requestAnimationFrame(()=>{let i=o.left+o.width/2-s.left-s.width/2,d=o.top+10-s.top;a.style.transform=`translate(${i}px,${d}px) scale(.9)`,a.style.opacity="0"}),setTimeout(()=>{a.remove(),t&&t()},450)}function ae(){let e=t=>(t.hp<1&&(t.hp=1),t.atk<0&&(t.atk=0),t);n.playerDeck=n.playerDeckChoice==="custom"&&n.customDeck?ye(n.customDeck.slice()):I[n.playerDeckChoice].map(K),n.playerDeck.forEach(t=>{e(t),t.owner="player",t.deck=n.playerDeckChoice==="custom"?"custom":n.playerDeckChoice}),n.aiDeck=I[n.aiDeckChoice].map(K),n.aiDeck.forEach(t=>{e(t),t.owner="ai",t.deck=n.aiDeckChoice}),n.playerDiscard=[],n.aiDiscard=[],n.playerHand=[],n.aiHand=[],n.playerBoard=[],n.aiBoard=[],n.playerHP=30,n.aiHP=30,n.current="player",n.playerMana=0,n.playerManaCap=0,n.playerHarvest=0,n.playerHarvestCap=0,n.aiMana=0,n.aiManaCap=0,n.aiHarvest=0,n.aiHarvestCap=0,G("player",3),G("ai",3),Q(),R(),N(),A("combat"),y("A batalha come\xE7ou!"),k("start")}var ye=e=>{for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e};function Ve(e,t){let s=r.drawPile,a=s.getBoundingClientRect(),o=0,i=r.pHand.getBoundingClientRect();e.forEach((d,l)=>{let c=s.querySelector("img").cloneNode();Object.assign(c.style,{position:"fixed",left:a.left+"px",top:a.top+"px",width:a.width+"px",height:a.height+"px",transition:"transform .4s ease,opacity .4s ease",zIndex:1500+l}),document.body.appendChild(c),setTimeout(()=>{let h=i.left+i.width/2-a.left-a.width/2,f=i.top+10-a.top;c.style.transform=`translate(${h}px,${f}px)`},l*150),setTimeout(()=>{c.remove(),o++,o===e.length&&t()},400+l*150)}),e.length||t()}function Se(e){let t=e==="player"?r.discardPile:r.aiDiscardPile,s=e==="player"?r.drawPile:r.aiDrawPile,a=t.querySelector("img");if(!a)return;let o=t.getBoundingClientRect(),i=s.getBoundingClientRect(),d=a.cloneNode();Object.assign(d.style,{position:"fixed",left:o.left+"px",top:o.top+"px",width:o.width+"px",height:o.height+"px",transition:"transform .5s ease",zIndex:1500}),document.body.appendChild(d),requestAnimationFrame(()=>{let l=i.left-o.left,c=i.top-o.top;d.style.transform=`translate(${l}px,${c}px)`}),setTimeout(()=>d.remove(),500)}function G(e,t=1){let s=e==="player"?n.playerDeck:n.aiDeck,a=e==="player"?n.playerHand:n.aiHand,o=e==="player"?n.playerDiscard:n.aiDiscard,i=[];for(let d=0;d<t;d++)if(s.length===0&&o.length&&(Se(e),o.forEach(X),s.push(...ye(o.splice(0)))),s.length){let l=s.shift();X(l),l.hp<1&&(l.hp=1),i.push(l)}e==="player"?Ve(i,()=>{a.push(...i),he(),r.drawCount.textContent=n.playerDeck.length,r.discardCount.textContent=n.playerDiscard.length}):a.push(...i)}function Q(){n.current==="player"?(n.playerManaCap=b(n.playerManaCap+1,0,10),n.playerMana=n.playerManaCap,n.playerHarvestCap=b(n.playerHarvestCap+1,0,10),n.playerHarvest=n.playerHarvestCap,G("player",1),n.playerBoard.forEach(e=>e.canAttack=!0)):(n.aiManaCap=b(n.aiManaCap+1,0,10),n.aiMana=n.aiManaCap,n.aiHarvestCap=b(n.aiHarvestCap+1,0,10),n.aiHarvest=n.aiHarvestCap,G("ai",1),n.aiBoard.forEach(e=>e.canAttack=!0)),R()}function Oe(){n.current==="player"&&(n.current="ai",n.chosen=null,j(),Q(),k("end"),setTimeout(()=>le({G:n,summon:ge,renderAll:R,legalTarget:be,attackCard:Ee,attackFace:Ae,rand:V,newTurn:Q}),500))}function pe(e,t){if(n.current!=="player")return;let s=n.playerHand.findIndex(o=>o.id===e);if(s<0)return;let a=n.playerHand[s];a.cost>n.playerMana||a.harvestCost>n.playerHarvest||n.playerBoard.length>=5||(n.playerHand.splice(s,1),ge("player",a,t),n.playerMana-=a.cost,n.playerHarvest-=a.harvestCost,R(),k(t==="defense"?"defense":"play"))}function ge(e,t,s="attack"){let a=e==="player"?n.playerBoard:n.aiBoard;t.stance=s,t.canAttack=s==="attack"&&t.kw.includes("Furioso"),a.push(t),y(`${e==="player"?"Voc\xEA":"Inimigo"} jogou ${t.name} em modo ${s==="defense"?"defesa":"ataque"}.`),Ne(e,t),s==="defense"&&setTimeout(()=>ne(t.id),30)}function Ne(e,t){let s=e==="player"?"ai":"player";switch(t.battlecry){case"draw1":G(e,1),y(`${t.name}: comprou 1 carta.`);break;case"heal2":{let a=e==="player"?n.playerBoard:n.aiBoard;if(a.length){let o=V(a);o.hp=Math.min(o.hp+2,20),Y(o.id,"+2","heal");let i=x(o.id);if(i){let d=i.getBoundingClientRect();se("healing",d.left+d.width/2,d.top+d.height/2)}y(`${t.name}: curou 2 em ${o.name}.`)}}break;case"ping1":{let a=s==="ai"?n.aiBoard:n.playerBoard;if(a.length){let o=V(a);ee(o,1),S(o.id,"attack"),Y(o.id,"-1","dmg"),y(`${t.name}: 1 de dano em ${o.name}.`),oe(),R(),k("hit")}}break;case"buffRandom1":{let a=(e==="player"?n.playerBoard:n.aiBoard).filter(o=>o.id!==t.id);if(a.length){let o=V(a);o.atk+=1,o.hp+=1,Y(o.id,"+1/+1","buff"),S(o.id,"magic"),y(`${t.name}: deu +1/+1 em ${o.name}.`)}}break;case"buffAlliesAtk1":{let a=(e==="player"?n.playerBoard:n.aiBoard).filter(o=>o.id!==t.id);a.forEach(o=>{o.atk+=1,Y(o.id,"+1 ATK","buff"),S(o.id,"magic")}),a.length&&y(`${t.name}: aliados ganharam +1 de ataque.`)}break}}function j(){document.body.classList.toggle("targeting",!!n.chosen)}function ve(){if(!n.chosen)return!1;if(n.current!=="player")return n.chosen=null,document.body.classList.remove("targeting"),!1;let e=n.playerBoard.find(t=>t.id===n.chosen.id);return!e||!e.canAttack||e.stance==="defense"?(n.chosen=null,document.body.classList.remove("targeting"),!1):(n.chosen=e,!0)}function Ce(){n.chosen&&(n.chosen=null,j(),r.aBoard.classList.remove("face-can-attack"),te(),W())}function qe(e){let t=e.getBoundingClientRect(),s=t.left+t.width/2,a=t.top+t.height/2;W(),H=document.createElement("div"),H.className="target-line",document.body.appendChild(H),q=o=>{let i=o.clientX-s,d=o.clientY-a,l=Math.hypot(i,d),c=Math.atan2(d,i)*(180/Math.PI);H.style.width=l+"px",H.style.transform=`translate(${s}px,${a}px) rotate(${c}deg)`},document.addEventListener("mousemove",q)}function W(){q&&document.removeEventListener("mousemove",q),q=null,H&&H.remove(),H=null}function Ie(e){n.current!=="player"||!e.canAttack||e.stance==="defense"||(n.chosen=e,j(),te(),ke(),n.aiBoard.filter(t=>t.stance==="defense").forEach(t=>setTimeout(()=>ne(t.id),20)))}function ke(){let e=fe(n.aiBoard),s=ve()&&!e,a=document.querySelector("#aiBoard .face-attack-btn");s?(r.aBoard.classList.add("face-can-attack"),a&&(a.style.display="block")):(r.aBoard.classList.remove("face-can-attack"),a&&(a.style.display="none"))}function be(e,t){let s=e==="ai"?n.aiBoard:n.playerBoard;return fe(s)?t.kw.includes("Protetor")||t.stance==="defense":!0}var x=e=>document.querySelector(`.card[data-id="${e}"]`),Z=(e,t,s=400)=>{e&&e.classList.add(t),setTimeout(()=>e&&e.classList.remove(t),s)},xe=(e,t)=>{let s=x(e),a=t?x(t):null;Z(s,"attack-lunge",350),a&&Z(a,"hit-shake",350)},ne=e=>{let t=x(e);Z(t,"shield-flash",600)};function Be(e,t,s){let a=document.createElement("div");a.className="fx fx-slash",a.style.left=e+"px",a.style.top=t+"px",a.style.setProperty("--ang",s+"deg"),document.body.appendChild(a),setTimeout(()=>a.remove(),380)}function se(e,t,s){let a=document.createElement("div");a.className="fx fx-"+e,a.style.left=t+"px",a.style.top=s+"px",document.body.appendChild(a),setTimeout(()=>a.remove(),600)}function S(e,t){let s=x(e);if(!s)return;let a=s.getBoundingClientRect();se(t,a.left+a.width/2,a.top+a.height/2)}function Fe(e,t){let s=e==="ai"?r.aHP2:r.pHP2;if(!s)return;let a=s.getBoundingClientRect();se(t,a.left+a.width/2,a.top+a.height/2)}function Y(e,t,s){let a=document.querySelector(`.card[data-id="${e}"]`);if(!a)return;let o=a.getBoundingClientRect(),i=document.createElement("div");i.className="fx-float "+(s||""),i.textContent=t,i.style.left=o.left+o.width/2+"px",i.style.top=o.top+o.height/2+"px",document.body.appendChild(i),setTimeout(()=>i.remove(),950)}function Ee(e,t){if(!e||!e.canAttack||e.stance==="defense")return;k("attack");let s=x(e.id),a=x(t.id);if(s&&a){let d=s.getBoundingClientRect(),l=a.getBoundingClientRect();Be(d.right,d.top+d.height/2,15)}xe(e.id,t.id),t.stance==="defense"&&ne(t.id),S(t.id,"attack");let o=t.hp,i=Math.max(0,e.atk-o);ee(t,e.atk),ee(e,t.atk),k("hit"),i>0&&t.hp<=0&&(n.playerBoard.includes(e)?(n.aiHP=b(n.aiHP-i,0,99),y(`${e.name} excedeu em ${i} e causou dano direto ao Inimigo!`)):(n.playerHP=b(n.playerHP-i,0,99),y(`${e.name} excedeu em ${i} e causou dano direto a Voc\xEA!`)),Pe()),e.canAttack=!1,y(`${e.name} atacou ${t.name}.`),oe(),R(),n.chosen=null,j(),r.aBoard.classList.remove("face-can-attack"),W()}function Ae(e,t){if(!e||!e.canAttack||e.stance==="defense")return;k("attack");let s=x(e.id);if(s){let o=s.getBoundingClientRect();Be(o.right,o.top+o.height/2,10)}xe(e.id,null),Fe(t,"attack");let a=e.atk;e.canAttack=!1,t==="ai"?(n.aiHP=b(n.aiHP-a,0,99),y(`${e.name} causou ${a} ao Inimigo!`),k("crit")):(n.playerHP=b(n.playerHP-a,0,99),y(`${e.name} causou ${a} a Voc\xEA!`),k("hit")),Pe(),n.chosen=null,j(),r.aBoard.classList.remove("face-can-attack"),R(),W()}function ee(e,t){!e||typeof t!="number"||(e.hp=b(e.hp-t,0,99),e.hp<=0&&setTimeout(oe,10))}function oe(){let e=n.aiBoard.filter(s=>s.hp<=0);e.forEach(s=>{S(s.id,"explosion"),X(s)}),e.length&&(n.aiBoard=n.aiBoard.filter(s=>s.hp>0),n.aiDiscard.push(...e),y("Uma criatura inimiga caiu."));let t=n.playerBoard.filter(s=>s.hp<=0);t.forEach(s=>{S(s.id,"explosion"),X(s)}),t.length&&(n.playerBoard=n.playerBoard.filter(s=>s.hp>0),n.playerDiscard.push(...t),y("Sua criatura caiu.")),r.discardCount.textContent=n.playerDiscard.length}function Ge(e){let t=document.createElement("div");t.className="boom",t.style.left="50%",t.style.top="50%",t.style.background=`radial-gradient(circle at 50% 50%, ${e?"#8bf5a2":"#ff8a8a"}, transparent)`,document.body.appendChild(t),setTimeout(()=>t.remove(),650)}function me(e){N(),r.endMsg.textContent=e?"You WIN!":"You Lose...",r.endMsg.style.color=e?"#8bf5a2":"#ff8a8a",r.endSub.textContent=e?"Parab\xE9ns! Quer continuar jogando?":"Tentar de novo ou voltar ao menu.",r.endOverlay.classList.add("show"),setTimeout(()=>Ge(e),1e3)}function Pe(){n.aiHP<=0&&me(!0),n.playerHP<=0&&me(!1)}function je(){let e=[];for(let t of Object.keys(I))for(let s of I[t]){let a=K(s);a.deck=t,e.push(a)}return e}function ie(e="all",t=!1){r.encyGrid.innerHTML="",(e==="all"?je():I[e].map(K).map(a=>Object.assign(a,{deck:e}))).forEach(a=>{let o=document.createElement("div");o.className=`card ency-card bg-${a.deck}`,o.innerHTML=`<div class='bg bg-${a.deck}'></div><div class='head'><span class='cost'>${a.cost}${a.harvestCost?`\u{1F33E}${a.harvestCost}`:""}</span><div class='name'>${a.name}</div></div><div class='mini'>${a.tribe} \u2022 \u2694\uFE0F ${a.atk} / \u2764\uFE0F ${a.hp}</div><div class='art'>${a.emoji}</div><div class='details'><div>${(a.kw||[]).map(i=>`<span class='chip' data-type='keyword' data-tip='${i==="Protetor"?"Enquanto houver Protetor ou carta em Defesa do lado do defensor, ataques devem mir\xE1-los.":i==="Furioso"?"Pode atacar no turno em que \xE9 jogada.":""}' >${i}</span>`).join(" ")}</div><div style='margin-top:6px'>${a.text||""}</div></div>`,F(o),r.encyGrid.appendChild(o)}),r.ency.classList.add("show"),r.encyFilters.style.display=t?"none":"flex",D(".filters .fbtn").forEach(a=>a.classList.toggle("active",a.dataset.deck===e||e==="all"&&a.dataset.deck==="all"))}r.endBtn.addEventListener("click",Oe);r.muteBtn.addEventListener("click",()=>{w(),P(),ce(r.muteBtn)});window.addEventListener("keydown",e=>{e.key==="Escape"&&Ce()});document.addEventListener("click",e=>{n.chosen&&(e.target.closest("#aiBoard .card.selectable")||e.target.closest("#playerBoard .card.selectable")||e.target.closest("#aiBoard .face-attack-btn")||Ce())},{capture:!0});D(".deckbtn").forEach(e=>{e.addEventListener("pointermove",s=>{let a=e.getBoundingClientRect();e.style.setProperty("--px",(s.clientX-a.left)/a.width*100+"%"),e.style.setProperty("--py",(s.clientY-a.top)/a.height*100+"%")}),e.addEventListener("mouseenter",()=>{e.style.setProperty("--halo",.7),e.style.setProperty("--shine",.7)}),e.addEventListener("mouseleave",()=>{e.style.removeProperty("--halo"),e.style.removeProperty("--shine")}),e.addEventListener("click",()=>{let s=e.dataset.deck;n.playerDeckChoice=s,de.includes(s)?n.aiDeckChoice=V(Le):n.aiDeckChoice=V(de),A(s),D(".deckbtn").forEach(a=>a.style.outline="none"),e.style.outline="2px solid var(--accent)"});let t=e.querySelector(".view-cards");t&&t.addEventListener("click",s=>{s.stopPropagation(),ie(e.dataset.deck,!0)})});r.startGame.addEventListener("click",()=>{r.start.style.display="none",w(),P(),N(),ae()});r.openEncy.addEventListener("click",()=>ie("all",!1));r.closeEncy.addEventListener("click",()=>{r.ency.classList.remove("show")});D(".filters .fbtn").forEach(e=>e.addEventListener("click",()=>{ie(e.dataset.deck,!1)}));r.playAgainBtn.addEventListener("click",()=>{r.endOverlay.classList.remove("show"),ae()});r.rematchBtn.addEventListener("click",()=>{r.endOverlay.classList.remove("show"),ae()});r.menuBtn.addEventListener("click",()=>{r.endOverlay.classList.remove("show"),r.start.style.display="grid",A("menu")});document.addEventListener("DOMContentLoaded",J);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&J()});window.addEventListener("pointerdown",()=>{w(),P(),A("menu")},{once:!0});})();
