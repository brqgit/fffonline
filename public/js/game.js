(()=>{var u=e=>document.querySelector(e),F=e=>Array.from(document.querySelectorAll(e));function p(e){let a=document.querySelector("#log");if(!a)return;let o=document.createElement("div");o.textContent=e,a.prepend(o)}var J=window.AudioContext||window.webkitAudioContext,m=null,A=null,D=!1,me=.18,pe=.18;function V(){J&&(m||(m=new J,A=m.createGain(),A.gain.value=.18,A.connect(m.destination)))}function L(){m&&m.state==="suspended"&&m.resume()}function v(e=440,a=.1,o="sine",n=1,r=0){if(!m||D)return;L();let s=m.createOscillator(),l=m.createGain();s.type=o,s.frequency.setValueAtTime(e,m.currentTime+r),l.gain.setValueAtTime(1e-4,m.currentTime+r),l.gain.exponentialRampToValueAtTime(Math.max(2e-4,n),m.currentTime+r+.01),l.gain.exponentialRampToValueAtTime(1e-4,m.currentTime+r+a),s.connect(l),l.connect(A),s.start(m.currentTime+r),s.stop(m.currentTime+r+a+.02)}function k(e){!m||D||({start:()=>{v(520,.08,"triangle",.7,0),v(780,.09,"triangle",.6,.08)},play:()=>{v(420,.07,"sine",.7,0),v(560,.08,"sine",.6,.06)},draw:()=>{v(660,.06,"square",.6,0),v(880,.08,"triangle",.5,.04)},defense:()=>{v(280,.09,"square",.6,0),v(200,.12,"sine",.5,.08)},attack:()=>{v(300,.06,"sawtooth",.7,0),v(220,.06,"sawtooth",.6,.05)},hit:()=>{v(160,.07,"square",.6,0)},overflow:()=>{v(600,.1,"triangle",.6,0)},death:()=>{v(420,.08,"sawtooth",.6,0),v(260,.12,"sawtooth",.55,.06)},end:()=>{v(600,.06,"triangle",.6,0),v(400,.06,"triangle",.5,.05)},crit:()=>{v(120,.08,"square",.75,0),v(90,.12,"square",.7,.06)},error:()=>{v(140,.05,"square",.6,0),v(140,.05,"square",.6,.06)}}[e]||(()=>{}))()}var g=null,Y=null,T=!1,$="menu",fe={menu:{bpm:84,leadBase:196,bassBase:98,leadWave:"triangle",bassWave:"sine",scale:[0,3,5,7,5,3,0,-5]},vikings:{bpm:76,leadBase:174.61,bassBase:87.31,leadWave:"sawtooth",bassWave:"sine",scale:[0,3,5,7,10,7,5,3]},animais:{bpm:90,leadBase:220,bassBase:110,leadWave:"square",bassWave:"sine",scale:[0,2,5,7,9,7,5,2]},pescadores:{bpm:96,leadBase:196,bassBase:98,leadWave:"triangle",bassWave:"triangle",scale:[0,2,4,7,9,7,4,2]},floresta:{bpm:68,leadBase:207.65,bassBase:103.83,leadWave:"sine",bassWave:"sine",scale:[0,3,5,10,5,3,0,-2]},combat:{bpm:118,leadBase:220,bassBase:110,leadWave:"sawtooth",bassWave:"square",scale:[0,2,3,5,7,8,7,5],perc:!0,ac:4}};function H(e){if(!J||D||(V(),L(),e&&e!==$&&T&&O(),$=e||$||"menu",T))return;T=!0;let a=fe[$]||fe.menu;g=m.createGain(),g.gain.value=1e-4,g.connect(A);let o=$==="combat"?.22:.18;g.gain.exponentialRampToValueAtTime(o,m.currentTime+.4);let n=60/a.bpm,r=a.scale.length,s=()=>{if(!T||!g)return;let d=m.currentTime;for(let c=0;c<r;c++){let h=a.leadBase*Math.pow(2,a.scale[c]/12),y=m.createOscillator(),C=m.createGain();y.type=a.leadWave,y.frequency.setValueAtTime(h,d+c*n),C.gain.setValueAtTime(1e-4,d+c*n),C.gain.exponentialRampToValueAtTime($==="combat"?.13:.11,d+c*n+.01),C.gain.exponentialRampToValueAtTime(1e-4,d+c*n+n*.92),y.connect(C),C.connect(g),y.start(d+c*n),y.stop(d+c*n+n)}for(let c=0;c<r;c+=2){let h=m.createOscillator(),y=m.createGain();h.type=a.bassWave,h.frequency.setValueAtTime(a.bassBase,d+c*n),y.gain.setValueAtTime(1e-4,d+c*n),y.gain.exponentialRampToValueAtTime($==="combat"?.1:.09,d+c*n+.01),y.gain.exponentialRampToValueAtTime(1e-4,d+c*n+n*.96),h.connect(y),y.connect(g),h.start(d+c*n),h.stop(d+c*n+n)}if(a.perc)for(let c=0;c<r;c++){let h=m.createOscillator(),y=m.createGain();if(h.type="square",h.frequency.setValueAtTime(1600,d+c*n),y.gain.setValueAtTime(1e-4,d+c*n),y.gain.exponentialRampToValueAtTime(.07,d+c*n+.005),y.gain.exponentialRampToValueAtTime(1e-4,d+c*n+n*.2),h.connect(y),y.connect(g),h.start(d+c*n),h.stop(d+c*n+n*.2),a.ac&&c%a.ac===0){let C=m.createOscillator(),f=m.createGain();C.type="sine",C.frequency.setValueAtTime(120,d+c*n),f.gain.setValueAtTime(1e-4,d+c*n),f.gain.exponentialRampToValueAtTime(.12,d+c*n+.01),f.gain.exponentialRampToValueAtTime(1e-4,d+c*n+n*.3),C.connect(f),f.connect(g),C.start(d+c*n),C.stop(d+c*n+n*.3)}}};s();let l=n*r*1e3;Y=setInterval(s,l-25)}function O(){if(T&&(T=!1,Y&&(clearInterval(Y),Y=null),g)){try{g.gain.exponentialRampToValueAtTime(1e-4,m.currentTime+.25)}catch{}setTimeout(()=>{try{g.disconnect()}catch{}g=null},300)}}function ne(){if(J){V();try{L()}catch{}try{H("menu")}catch{}if(m&&m.state!=="running")try{m.resume().then(()=>H("menu")).catch(()=>{})}catch{}if(!T){let e=0,a=setInterval(()=>{if(e++,T||e>8){clearInterval(a);return}try{V(),L(),H("menu")}catch{}},800)}}}function he(e){D=!D,D?(A&&(me=A.gain.value,A.gain.value=0),g&&(pe=g.gain.value,g.gain.value=0)):(A&&(A.gain.value=me),g&&(g.gain.value=pe)),e&&(e.textContent=D?"\u{1F507} Mudo":"\u{1F50A} Som")}async function ye(e){let{G:a,summon:o,renderAll:n,legalTarget:r,attackCard:s,attackFace:l,rand:d,newTurn:c}=e,h=a.aiHand.filter(f=>f.cost<=a.aiMana&&f.harvestCost<=a.aiHarvest).sort((f,S)=>S.cost-f.cost);for(;h.length&&a.aiBoard.length<5&&a.aiMana>0;){let f=h.shift(),S=a.aiHand.findIndex(N=>N.id===f.id);if(S>-1&&f.cost<=a.aiMana&&f.harvestCost<=a.aiHarvest){a.aiHand.splice(S,1);let N=f.hp>=f.atk+1?Math.random()<.7?"defense":"attack":Math.random()<.3?"defense":"attack",te=o("ai",f,N);te&&typeof te.then=="function"?(n(),a.aiMana-=f.cost,a.aiHarvest-=f.harvestCost,await te):(a.aiMana-=f.cost,a.aiHarvest-=f.harvestCost),await new Promise(De=>setTimeout(De,120))}}n();let y=a.aiBoard.filter(f=>f.canAttack&&f.stance!=="defense");function C(){if(!y.length){a.current="player",c("ai");return}let f=y.shift(),S=a.playerBoard.filter(N=>r("player",N));S.length?s(f,d(S)):l(f,"player"),setTimeout(C,500)}setTimeout(C,500)}var ua=Object.freeze({MANA:"mana",ENERGIA:"energia",COLHEITA:"colheita"}),E=Object.freeze({FURIOSO:"Furioso",PROTETOR:"Protetor",PERCEPCAO:"Percep\xE7\xE3o",CURA:"Cura",BENCAO:"B\xEAn\xE7\xE3o",CORVO:"Corvo",SERPENTE:"Serpente",ABSORVER:"Absorver",MUTAVEL:"Mut\xE1vel"}),ma=Object.freeze({UNIDADE:"Unidade",RITUAL:"Ritual",LENDA_MITICA:"Lenda M\xEDtica",TOTEM:"Totem"}),pa=Object.freeze({VIKINGS:"Vikings",FLORESTA:"Floresta",SOMBRAS:"Sombras",RUNICO:"R\xFAnico",MITICO:"M\xEDtico"});var ve={vikings:[{name:"Ceifador do Fiorde"},{name:"Guardi\xE3o das Runas"},{name:"Berserker do Arado"},{name:"Escudeiro G\xE9lido"},{name:"Campon\xEAs Vigilante"},{name:"Batedor de Neve"},{name:"Runomante Rural"},{name:"Guerreiro das Geadas"},{name:"Ferreiro do Norte"},{name:"M\xEDstico da Colheita"},{name:"Raider do Gr\xE3o"},{name:"Defensor do Fiorde"},{name:"Sentinela do Arp\xE3o"},{name:"Martelo das Plan\xEDcies"},{name:"Ceifeira \xC1gil"},{name:"Guardi\xE3o da Aldeia"},{name:"Batalhador do Cais"},{name:"Escudeiro da Aurora"},{name:"Jarl da Tempestade",boss:!0},{name:"Lorde da Colheita Sombria",boss:!0}],animais:[{name:"Lobo Cinzento Alfa"},{name:"Urso do Gelo"},{name:"Javali das Neves"},{name:"Coruja Vigilante"},{name:"Serpente de Fj\xF6rnburg"},{name:"Lince Escamado"},{name:"Caribu R\xFAnico"},{name:"Falc\xE3o da Aurora"},{name:"Texugo \xC1rtico"},{name:"Raposa do Norte"},{name:"Bode Rochoso"},{name:"Corvo de Odin"},{name:"Alce Perenne"},{name:"Foca das Geleiras"},{name:"Lobo Sombrio"},{name:"Urs\xE3o Guardi\xE3o"},{name:"Bis\xE3o Boreal"},{name:"Esquilo R\xE1pido"},{name:"Fenrir Desperto",boss:!0},{name:"Urso R\xFAnico Antigo",boss:!0}],pescadores:[{name:"Arpoador Tempestuoso"},{name:"Marinheiro do Gelo"},{name:"Grumete das Ondas"},{name:"Vigia do Farol"},{name:"Ca\xE7ador de Sereias"},{name:"Navegador das Brumas"},{name:"Cors\xE1rio do Maelstrom"},{name:"Curandeiro do Mar"},{name:"Sentinela do Conv\xE9s"},{name:"Bardo do Porto"},{name:"Escudeiro do Cais"},{name:"Capit\xE3o das Mar\xE9s"},{name:"Lan\xE7ador de Redes"},{name:"Contrabandista do Fiorde"},{name:"Pescador de Runas"},{name:"Vigia das Profundezas"},{name:"Guardi\xE3o das Docas"},{name:"Ca\xE7ador de Tesouros"},{name:"Senhor do Maelstrom",boss:!0},{name:"Kraken do Fiorde",boss:!0}],floresta:[{name:"Guardi\xE3o Musgoso"},{name:"Raposa da N\xE9voa"},{name:"Cervo R\xFAnico"},{name:"Coruja Mensageira"},{name:"Lobo da Mata"},{name:"Fada das Folhas"},{name:"Javali Voraz"},{name:"Treant dos Espinhos"},{name:"Esp\xEDrito do Carvalho"},{name:"S\xE1bio do Musgo"},{name:"Guardi\xE3o da Clareira"},{name:"Lince da Sombra"},{name:"Bardo das \xC1rvores"},{name:"Druida dos Cogumelos"},{name:"Corvo Observador"},{name:"Serpente do Bosque"},{name:"Centauro das Brumas"},{name:"Javali de Runas"},{name:"Avatar do Carvalho Ancestral",boss:!0},{name:"Esp\xEDrito do Cervo Estelar",boss:!0}],convergentes:[{name:"Ne\xF3fito Prism\xE1tico"},{name:"Assimilador R\xFAnico"},{name:"Guardi\xE3o Quim\xE9rico"},{name:"Raider Metamorfo"},{name:"Lince Metam\xF3rfico"},{name:"Totem Absorvente"},{name:"Arauto da Aurora"},{name:"Sombra R\xFAnica"},{name:"Guerreiro Sincr\xE9tico"},{name:"Disc\xEDpulo Male\xE1vel"},{name:"Sentinela V\xF3rtice"},{name:"Tecel\xE3o Cambiante"},{name:"Eco Mutante"},{name:"Bruto Assimilador"},{name:"S\xE1bio Prismal"},{name:"Avatar Mutag\xEAnico"},{name:"Capataz de Runas"},{name:"Ess\xEAncia Convergente"},{name:"Catalisador da Aurora",boss:!0},{name:"Entidade Transmutante",boss:!0}]};var q=class{constructor({name:a="",icon:o="\u{1F5FF}",buffs:n={}}={}){this.name=a,this.icon=o,this.buffs=n}};var _=class{constructor({level:a=1}={}){this.level=a,this.round=0,this.totems=[],this.scaling=0,this.xp=0,this.bossInterval=10,this.eliteEvery=5,this.shopEvery=3,this.currentEncounter="normal"}nextRound(){this.round+=1,this.scaling=Math.floor(this.round/2)+(this.level-1);let a=this.round%this.bossInterval===0,o=!a&&this.round%this.eliteEvery===0,n=this.round%this.shopEvery===0;return this.currentEncounter=a?"boss":o?"elite":n?"shop":"normal",{isBoss:a,isElite:o,isShop:n}}handleVictory(){let a=this.currentEncounter==="boss"?20:this.currentEncounter==="elite"?10:5;return this.xp+=a,{leveled:this.checkLevelUp(),rewards:this.rewardOptions()}}rewardOptions(){return["Nova carta","Evoluir carta","Ganhar Totem","Buff permanente"]}checkLevelUp(){let a=this.level*50;return this.xp>=a?(this.level+=1,this.xp-=a,!0):!1}addTotem(a){return this.totems.length>=3?!1:(this.totems.push(a instanceof q?a:new q(a)),!0)}reset(){this.round=0,this.totems=[],this.xp=0,this.currentEncounter="normal"}};function ge(){return u("#commanderHud")}function Ve(){return u("#closeCommanderHud")}function oe(){let e=ge();e&&(e.style.display="grid")}function Fe(){let e=ge();e&&(e.style.display="none")}function Ce(){let e=Ve();e&&e.addEventListener("click",Fe)}var b=e=>e[Math.floor(Math.random()*e.length)],P=(e,a,o)=>Math.max(a,Math.min(o,e)),Ge=()=>Math.random().toString(36).slice(2),Ne=(e,a=!1)=>{let n=(ve[e]||[]).filter(s=>a?s.boss:!s.boss);return(n.length?b(n):{name:"Inimigo"}).name},Oe={P:E.PROTETOR,F:E.FURIOSO,PE:E.PERCEPCAO,C:E.CURA,B:E.BENCAO,CV:E.CORVO,S:E.SERPENTE,A:E.ABSORVER,M:E.MUTAVEL},qe={D1:"draw1",H2:"heal2",P1:"ping1",BR1:"buffRandom1",BA1:"buffAlliesAtk1"};function Ie(e){let a=e.toLowerCase();return a.includes("berserker")?{classe:"tank",subclasse:"Berserker"}:a.includes("guardi\xE3o do v\xE9u")||a.includes("v\xE9u")?{classe:"control",subclasse:"Guardi\xE3o do V\xE9u"}:a.includes("guardi\xE3o")?{classe:"tank",subclasse:"Guardi\xE3o"}:a.includes("uivante")?{classe:"tank",subclasse:"Uivante"}:a.includes("ca\xE7ador")?{classe:"dps",subclasse:"Ca\xE7ador"}:a.includes("runomante")?{classe:"dps",subclasse:"Runomante"}:a.includes("serpente")?{classe:"dps",subclasse:"Serpente"}:a.includes("curandeir")?{classe:"support",subclasse:"Curandeiro"}:a.includes("tot\xEAmico")||a.includes("totemico")?{classe:"support",subclasse:"Tot\xEAmico"}:a.includes("sacerdote")||a.includes("tecel\xE3o")?{classe:"support",subclasse:"Tecel\xE3o"}:a.includes("xam\xE3")?{classe:"control",subclasse:"Xam\xE3"}:a.includes("corvo")?{classe:"control",subclasse:"Corvo"}:a.includes("guerreiro")?{classe:"dps",subclasse:"Guerreiro"}:a.includes("raider")?{classe:"dps",subclasse:"Raider"}:a.includes("batalhador")?{classe:"dps",subclasse:"Batalhador"}:a.includes("mago")||a.includes("mistico")?{classe:"support",subclasse:"Mago"}:a.includes("sombras")||a.includes("encapuzado")?{classe:"control",subclasse:"Sombras"}:a.includes("navegador")?{classe:"support",subclasse:"Navegador"}:{classe:"",subclasse:""}}var I=e=>{let[a,o,n,r,s,l,d,c=0,h=0,y=0]=e,C=Ie(a||"");return{name:a,emoji:o,tribe:n,atk:r,hp:s,cost:l,harvestCost:y,text:d,kw:c?c.split("|").map(f=>Oe[f]):[],battlecry:h?qe[h]:void 0,classe:C.classe,subclasse:C.subclasse,id:Ge()}},G={vikings:[["Lavrador de Lan\xE7a","\u{1F9D4}\u200D\u{1F33E}","Viking",2,2,2,"Disciplinado"],["Camponesa Curandeira","\u{1F469}\u200D\u{1F33E}\u2728","Viking",2,3,3,"Entra: cura 2","","H2"],["Ceifeiro Berserker","\u{1F468}\u200D\u{1F33E}\u2694\uFE0F","Viking",5,2,4,"Furioso","F"],["Escudeiro Rural","\u{1F6E1}\uFE0F","Viking",0,3,1,"Protetor","P"],["Guardi\xE3o da Aldeia","\u{1F6E1}\uFE0F\u{1F33E}","Viking",3,5,4,"Protetor","P"],["Ca\xE7ador de Lobos","\u{1F3F9}","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Ferreiro Rural","\u{1F528}","Viking",4,6,5,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Chefe da Colheita","\u{1F451}\u{1F33E}","Viking",5,6,6,"Aliados +1 ATK","","BA1"],["Campon\xEAs Vigilante","","Viking",2,4,3,"Protetor","P"],["Herbalista do Vilarejo","","Viking",1,3,2,"Entra: cura 2","","H2"],["Batedor da Aldeia","","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Anci\xE3o do Trigo","","Viking",2,2,3,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Patriarca da Fazenda","","Viking",4,5,5,"Aliados +1 ATK","","BA1"],["Rastreador do Fiorde","","Viking",1,2,1,"Entra: compre 1","","D1"],["Ceifeira \xC1gil","","Viking",3,2,2,"Furioso","F"],["Defensor do Arado","","Viking",1,5,3,"Protetor","P"],["Runomante Rural","","Viking",2,3,3,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Guerreiro da Foice","","Viking",5,3,4,"Furioso","F"],["Guardi\xE3 do Celeiro","","Viking",3,6,5,"Protetor","P"],["Senhor do Campo","","Viking",6,6,6,"Aliados +1 ATK","","BA1"]],animais:[["Urso Pardo","\u{1F43B}","Animal",6,6,5,"Protetor","P"],["Lobo Cinzento","\u{1F43A}","Animal",4,2,3,"Furioso","F"],["Javali Selvagem","\u{1F417}","Animal",3,2,2,"Impulsivo"],["Cervo Nobre","\u{1F98C}","Animal",4,5,4,"Resistente"],["Coruja S\xE1bia","\u{1F989}","Animal",1,2,1,"Entra: compre 1","","D1"],["Cabra da Montanha","\u{1F410}","Animal",2,3,2,"Protetor","P"],["\xC1guia do Norte","\u{1F985}","Animal",5,3,4,"Veloz"],["Urso Polar","\u{1F43B}\u200D\u2744\uFE0F","Animal",7,7,6,"Gigante"],["Serpente do Mar","\u{1F40D}","Animal",8,7,7,"Colosso"],["Lobo Alfa","","Animal",5,4,4,"Furioso","F"],["Lince \xC1rtico","","Animal",3,3,3,"Veloz"],["Falc\xE3o das Montanhas","","Animal",2,3,3,"Entra: compre 1","","D1"],["Caribu Selvagem","","Animal",4,5,4,"Protetor","P"],["Texugo \xC1rtico","","Animal",3,2,2,"Furioso","F"],["Foca do Gelo","","Animal",2,3,2,"Entra: compre 1","","D1"],["Lobo Uivante","","Animal",4,3,4,"Furioso","F"],["Raposa Escarlate","","Animal",3,2,2,"Furioso","F"],["Touro das Neves","","Animal",5,5,5,"Protetor","P"],["Corvo Astuto","","Animal",1,2,2,"Entra: compre 1","","D1"],["Fera das Cavernas","","Animal",6,6,6,"Furioso","F"]],pescadores:[["Grumete do Fiorde","\u{1F466}\u{1F3A3}","Viking",1,1,1,"Aprendiz"],["Pescador do Fiorde","\u{1F9D4}\u200D\u2642\uFE0F\u{1F3A3}","Viking",2,3,2,"Veterano"],["Arpoador N\xF3rdico","\u{1FA9D}","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Curandeira do Sal","\u{1F9C2}\u2728","Viking",2,3,3,"Entra: cura 2","","H2"],["Vigia do Farol","\u{1F5FC}\u{1F6E1}\uFE0F","Viking",2,5,4,"Protetor","P"],["Ferreiro Naval","\u2693\uFE0F\u{1F528}","Viking",4,5,5,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Capit\xE3o da Pesca","\u{1F451}\u{1F3A3}","Viking",5,6,6,"Aliados +1 ATK","","BA1"],["Remador \xC1gil","\u{1F6A3}","Viking",4,2,3,"Furioso","F"],["Curandeiro do Mar","","Viking",1,4,3,"Entra: cura 2","","H2"],["Bardo do Porto","","Viking",2,3,3,"Aliados +1 ATK","","BA1"],["Ca\xE7ador de Tesouros","","Viking",2,2,2,"Entra: compre 1","","D1"],["Escudeiro do Conv\xE9s","","Viking",2,5,4,"Protetor","P"],["Guarda do Cais","","Viking",3,2,3,"Entra: dano 1 aleat\xF3rio","","P1"],["Aprendiz de Rede","","Viking",1,2,1,"Entra: compre 1","","D1"],["Baleeiro Leal","","Viking",2,4,3,"Protetor","P"],["Atirador do Conv\xE9s","","Viking",3,2,2,"Entra: dano 1 aleat\xF3rio","","P1"],["Sacerdote das Ondas","","Viking",2,3,3,"Entra: cura 2","","H2"],["Cors\xE1rio Intr\xE9pido","","Viking",4,2,3,"Furioso","F"],["Patrulheiro N\xE1utico","","Viking",3,5,4,"Protetor","P"],["Almirante do Fiorde","","Viking",5,5,6,"Aliados +1 ATK","","BA1"]],floresta:[["Urso Negro","\u{1F43B}","Animal",5,5,5,"Protetor","P"],["Lobo da Mata","\u{1F43A}","Animal",4,2,3,"Furioso","F"],["Javali da Floresta","\u{1F417}","Animal",3,2,2,"Impulsivo"],["Cervo Vermelho","\u{1F98C}","Animal",4,5,4,"Resistente"],["Coruja S\xE1bia","\u{1F989}","Animal",1,2,1,"Entra: compre 1","","D1"],["Raposa \xC1gil","\u{1F98A}","Animal",3,3,3,"Veloz"],["Bisonte das Colinas","\u{1F402}","Animal",6,6,6,"Imponente"],["Serpente do Bosque","\u{1F40D}","Animal",5,4,4,"Silenciosa"],["Lince da Sombra","","Animal",4,2,3,"Furioso","F"],["Corvo Observador","","Animal",1,2,2,"Entra: compre 1","","D1"],["Guardi\xE3o Musgoso","","Animal",3,5,4,"Protetor","P"],["Cervo R\xFAnico","","Animal",3,3,3,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Javali Voraz","","Animal",5,3,4,"Furioso","F"],["Lebre da N\xE9voa","","Animal",1,1,1,"Veloz"],["Guardi\xE3o da Clareira","","Animal",2,5,3,"Protetor","P"],["Raposa Sombria","","Animal",3,2,2,"Furioso","F"],["Urso Musgoso","","Animal",5,6,5,"Protetor","P"],["Coruja Mensageira","","Animal",1,2,2,"Entra: compre 1","","D1"],["Cervo das Runas","","Animal",3,3,3,"Entra: +1/+1 aleat\xF3rio","","BR1"],["Javali Espinhoso","","Animal",5,3,4,"Furioso","F"]],convergentes:[["Ne\xF3fito Convergente","\u{1F300}","Convergente",2,2,1,"Entra: copia uma palavra-chave de um aliado","A"],["Proteiforme da Aurora","\u{1F308}","Convergente",3,3,3,"","M"],["Guardi\xE3o Quim\xE9rico","\u{1F6E1}\uFE0F\u{1F43A}","Convergente",2,6,4,"","P|M"],["Raider Metamorfo","\u2694\uFE0F\u{1F30A}","Convergente",4,2,3,"","F|M"],["Runa Voraz","\u{1F300}\u{1FAA8}","Convergente",1,4,2,"Ganha +1 ATK sempre que um aliado morre."],["Totem Absorvente","\u{1FAB5}\u{1F300}","Convergente",0,5,3,"Fim de turno: copia uma palavra-chave de um inimigo aleat\xF3rio.","P"],["Arauto da Aurora","\u2728\u{1F451}","Convergente",5,5,6,"Se voc\xEA copiou \u22653 palavras-chave na partida, aliados +1/+1."],["Sombra R\xFAnica","\u{1F318}\u{1F300}","Convergente",3,3,3,"Sempre que absorver, ganha +1/+1.","A"],["Guerreiro Sincr\xE9tico","\u2694\uFE0F\u{1F6E1}\uFE0F","Convergente",4,4,4,"Entra: escolha Furioso ou Protetor; ganha essa palavra-chave."],["Lince Metam\xF3rfico","\u{1F431}\u{1F308}","Convergente",3,2,2,"","F|M"],["Capataz de Runas","\u{1F300}\u2699\uFE0F","Convergente",2,4,3,"Ao absorver, causa 1 de dano a todos os inimigos.","A"],["Colosso Alqu\xEDmico","\u{1F5FF}\u{1F308}","Convergente",7,7,7,"Entra: copia uma palavra-chave de cada aliado.","M"],["Ess\xEAncia Convergente","\u{1F4A0}","Convergente",0,0,1,"Entra com ATK/HP iguais ao n\xBA de palavras-chave diferentes que voc\xEA controla.","A"],["Disc\xEDpulo Male\xE1vel","","Convergente",1,3,2,"","M"],["Sentinela V\xF3rtice","","Convergente",2,4,3,"Entra: copia uma palavra-chave de um aliado","P|A"],["Tecel\xE3o Cambiante","","Convergente",2,3,3,"Entra: compre 1","A","D1"],["Eco Mutante","","Convergente",4,4,4,"","A|M"],["Bruto Assimilador","","Convergente",5,5,5,"","A|M"],["S\xE1bio Prismal","","Convergente",3,5,4,"Entra: +1/+1 aleat\xF3rio","M","BR1"],["Avatar Mutag\xEAnico","","Convergente",6,6,6,"","M"]],convergentes:[["Ne\xF3fito Convergente","\u{1F300}","Convergente",2,2,1,"Entra: copia uma palavra-chave de um aliado","A"],["Proteiforme da Aurora","\u{1F308}","Convergente",3,3,3,"","M"],["Guardi\xE3o Quim\xE9rico","\u{1F6E1}\uFE0F\u{1F43A}","Convergente",2,6,4,"","P|M"],["Raider Metamorfo","\u2694\uFE0F\u{1F30A}","Convergente",4,2,3,"","F|M"],["Runa Voraz","\u{1F300}\u{1FAA8}","Convergente",1,4,2,"Ganha +1 ATK sempre que um aliado morre."],["Totem Absorvente","\u{1FAB5}\u{1F300}","Convergente",0,5,3,"Fim de turno: copia uma palavra-chave de um inimigo aleat\xF3rio.","P"],["Arauto da Aurora","\u2728\u{1F451}","Convergente",5,5,6,"Se voc\xEA copiou \u22653 palavras-chave na partida, aliados +1/+1."],["Sombra R\xFAnica","\u{1F318}\u{1F300}","Convergente",3,3,3,"Sempre que absorver, ganha +1/+1.","A"],["Guerreiro Sincr\xE9tico","\u2694\uFE0F\u{1F6E1}\uFE0F","Convergente",4,4,4,"Entra: escolha Furioso ou Protetor; ganha essa palavra-chave."],["Lince Metam\xF3rfico","\u{1F431}\u{1F308}","Convergente",3,2,2,"","F|M"],["Capataz de Runas","\u{1F300}\u2699\uFE0F","Convergente",2,4,3,"Ao absorver, causa 1 de dano a todos os inimigos.","A"],["Colosso Alqu\xEDmico","\u{1F5FF}\u{1F308}","Convergente",7,7,7,"Entra: copia uma palavra-chave de cada aliado.","M"],["Ess\xEAncia Convergente","\u{1F4A0}","Convergente",0,0,1,"Entra com ATK/HP iguais ao n\xBA de palavras-chave diferentes que voc\xEA controla.","A"]]},B={vikings:{name:"Eirik",classe:"Guerreiro",base:{atk:2,hp:30},slots:{weapon:1,armor:1,trinket:1},icon:"\u{1F9D4}\u200D\u{1F33E}"},animais:{name:"M\xE3e da Alcateia",classe:"Druida",base:{atk:1,hp:30},slots:{companion:3},icon:"\u{1F43A}"},pescadores:{name:"Capit\xE3o do Porto",classe:"Navegador",base:{atk:1,hp:30},slots:{weapon:1,armor:1},icon:"\u{1F3A3}"},floresta:{name:"Guardi\xE3 da Floresta",classe:"Tot\xEAmico",base:{atk:1,hp:30},slots:{totem:2,charm:1},icon:"\u{1F98C}"},convergentes:{name:"Avatar Prismal",classe:"M\xEDstico",base:{atk:0,hp:30},slots:{essence:3},icon:"\u{1F300}"},custom:{name:"Comandante",classe:"",base:{atk:0,hp:30},slots:{weapon:1,armor:1,trinket:1},icon:"\u{1F464}"}},ce=Object.keys(G),t={playerHP:30,aiHP:30,turn:1,playerMana:0,playerManaCap:0,playerHarvest:0,playerHarvestCap:0,aiMana:0,aiManaCap:0,aiHarvest:0,aiHarvestCap:0,current:"player",playerDeck:[],aiDeck:[],playerHand:[],aiHand:[],playerBoard:[],aiBoard:[],playerDiscard:[],aiDiscard:[],playerCommander:B.vikings,aiCommander:B.floresta,commanderBuffsDirty:!0,chosen:null,playerDeckChoice:"vikings",aiDeckChoice:b(ce),customDeck:null,mode:"solo",story:null,maxHandSize:5,totems:[],enemyScaling:0},i={pHP:u("#playerHP"),pHP2:u("#playerHP2"),aHP:u("#aiHP"),aHP2:u("#aiHP2"),mana:u("#mana"),pHand:u("#playerHand"),pBoard:u("#playerBoard"),aBoard:u("#aiBoard"),endBtn:u("#endTurnBtn"),muteBtn:u("#muteBtn"),pAva:u("#playerAvatar"),aAva:u("#aiAvatar"),drawCount:u("#drawCount"),discardCount:u("#discardCount"),barPHP:u("#barPlayerHP"),barAHP:u("#barAiHP"),barMana:u("#barMana"),start:u("#start"),openEncy:u("#openEncy"),ency:u("#ency"),encyGrid:u("#encyGrid"),encyFilters:u("#encyFilters"),closeEncy:u("#closeEncy"),startGame:u("#startGame"),endOverlay:u("#endOverlay"),endMsg:u("#endMsg"),endSub:u("#endSub"),playAgainBtn:u("#playAgainBtn"),rematchBtn:u("#rematchBtn"),menuBtn:u("#menuBtn"),totemBar:u("#totemBar"),playerCommander:u("#playerCommander")},Ta=u("#pool"),Ha=u("#chosen"),La=u("#countDeck"),wa=u("#curve");window.addEventListener("error",function(e){console.error("JS Error:",e.message,e.filename+":"+e.lineno);try{typeof p=="function"&&p("\u26A0\uFE0F "+e.message)}catch{}});window.addEventListener("unhandledrejection",function(e){console.error("Unhandled Rejection:",e.reason);try{let a=e.reason&&e.reason.message?e.reason.message:String(e.reason);typeof p=="function"&&p("\u26A0\uFE0F "+a)}catch{}});function Q(e,a=!1){let o=e.offsetHeight,n=e.offsetWidth,r=!1;a?(e.addEventListener("mouseenter",()=>{e.classList.contains("chosen")||(r=!0,e.style.zIndex=1e3,e.style.transform="translateY(-20px)")}),e.addEventListener("mouseleave",()=>{e.classList.contains("chosen")||(r=!1,e.style.zIndex=e.dataset.z||"",e.style.transform="")})):e.addEventListener("mouseleave",()=>{e.classList.contains("chosen")||(e.style.transform="")}),e.addEventListener("mousemove",s=>{if(e.classList.contains("chosen"))return;let l=(s.offsetX/n-.5)*12,d=(s.offsetY/o-.5)*-12,c=r?-20:0;e.style.transform=`translateY(${c}px) perspective(600px) rotateX(${d}deg) rotateY(${l}deg)`})}function z(e,a){let o=document.createElement("div");o.className=`card ${a==="player"?"me":"enemy"} ${e.stance==="defense"?"defense":""}`,o.dataset.id=e.id;let n=`${e.cost}${e.harvestCost?`\u{1F33E}${e.harvestCost}`:""}`,r=(e.kw||[]).map(s=>`<span class='keyword' data-tip='${s==="Protetor"?"Enquanto houver Protetor ou carta em Defesa do lado do defensor, ataques devem mir\xE1-los.":s==="Furioso"?"Pode atacar no turno em que \xE9 jogada.":s==="Absorver"?"Ao entrar, copia uma palavra-chave de um aliado.":s==="Mut\xE1vel"?"No fim do turno, troca ATK e HP.":""}' >${s}</span>`);return e.subclasse&&e.classe&&r.push(`<span class='class-tag ${e.classe}'>${e.subclasse}</span>`),o.innerHTML=`<div class="bg bg-${e.deck||"default"}"></div><div class="head"><span class="cost">${n}</span><div class="name">${e.name}</div>${e.stance?`<span class="badge ${e.stance==="defense"?"def":"atk"}">${e.stance==="defense"?"\u{1F6E1}\uFE0F":"\u2694\uFE0F"}</span>`:""}</div><div class="tribe">${e.tribe}</div><div class="art">${e.emoji}</div><div class="text">${r.join(" ")} ${e.text||""}</div><div class="stats"><span class="gem atk">\u2694\uFE0F ${e.atk}</span>${e.stance?`<span class="stance-label ${e.stance}">${e.stance==="defense"?"\u{1F6E1}\uFE0F":"\u2694\uFE0F"}</span>`:""}<span class="gem hp ${e.hp<=2?"low":""}">\u2764\uFE0F ${e.hp}</span></div>`,o}function X(e){e&&(e.stance=null,e.canAttack=!1,delete e.summonTurn)}var Ee=e=>e.some(a=>a.kw.includes("Protetor")||a.stance==="defense");function ze(){let e=(a,o)=>o>0?Math.max(0,Math.min(100,a/o*100)):0;i.barPHP.style.width=e(t.playerHP,30)+"%",i.barAHP.style.width=e(t.aiHP,30)+"%",i.barMana.style.width=e(t.playerMana,t.playerManaCap)+"%"}function w(){i.pHP.textContent=t.playerHP,i.pHP2.textContent=t.playerHP,i.aHP.textContent=t.aiHP,i.aHP2.textContent=t.aiHP,i.mana.textContent=`${t.playerMana}/${t.playerManaCap} | \u{1F33E} ${t.playerHarvest}/${t.playerHarvestCap}`,i.endBtn.disabled=t.current!=="player",i.drawCount.textContent=t.playerDeck.length,i.discardCount.textContent=t.playerDiscard.length,ze(),je(),le(),Ke(),We()}function je(){i.pHand.innerHTML="",t.playerHand.forEach(e=>{let a=z(e,"player");a.classList.add("handcard"),Q(a,!0),a.addEventListener("click",r=>{if(a.classList.contains("chosen"))return;if(e.cost>t.playerMana||e.harvestCost>t.playerHarvest||t.current!=="player"||e.type!=="totem"&&t.playerBoard.length>=5){a.style.transform="translateY(-2px)",setTimeout(()=>a.style.transform="",150),k("error");return}r.stopPropagation(),Ye(a,l=>{a.style.visibility="hidden",Je(a,()=>ea(e.id,l))},()=>{a.style.visibility=""})});let o=e.cost>t.playerMana||e.harvestCost>t.playerHarvest,n=t.current!=="player"||e.type!=="totem"&&t.playerBoard.length>=5;a.classList.toggle("blocked",o),a.style.opacity=o||n?.9:1,a.style.cursor=o||n?"not-allowed":"pointer",i.pHand.appendChild(a)}),Ue()}function Ue(){let e=F("#playerHand .card"),a=e.length;if(!a)return;let o=150,r=e[0].offsetWidth-o;i.pHand.style.setProperty("--hover-shift",`${r}px`),e.forEach((s,l)=>{let d=(l-(a-1)/2)*o;s.style.setProperty("--x",`${d}px`),s.dataset.z=String(l+1),s.style.zIndex=l+1})}function We(){if(i.totemBar){i.totemBar.innerHTML="";for(let e=0;e<3;e++){let a=document.createElement("div");a.className="totem-slot",t.totems[e]&&(a.textContent="\u{1F5FF}"),i.totemBar.appendChild(a)}}}function Ke(){if(i.playerCommander&&(i.playerCommander.innerHTML="",t.playerCommander)){let e=z(t.playerCommander,"player");i.playerCommander.appendChild(e)}if(i.aiCommander&&(i.aiCommander.innerHTML="",t.aiCommander)){let e=z(t.aiCommander,"ai");i.aiCommander.appendChild(e)}}function le(){t.commanderBuffsDirty&&(Xe(),t.commanderBuffsDirty=!1),Pe(),i.pBoard.innerHTML="";for(let a of t.playerBoard){let o=z(a,"player");Q(o),t.current==="player"&&a.canAttack&&a.stance!=="defense"&&(o.classList.add("selectable"),o.addEventListener("click",()=>oa(a))),i.pBoard.appendChild(o)}i.aBoard.innerHTML="";for(let a of t.aiBoard){let o=z(a,"ai");Q(o),t.chosen&&He("ai",a)&&(o.classList.add("selectable"),o.addEventListener("click",()=>Re(t.chosen,a))),i.aBoard.appendChild(o)}let e=document.querySelector("#aiBoard .face-attack-btn");e||(e=document.createElement("button"),e.type="button",e.className="btn-ghost face-attack-btn",e.textContent="\u{1F5E1}\uFE0F Atacar diretamente",Object.assign(e.style,{position:"absolute",top:"8px",right:"8px",display:"none"}),e.addEventListener("click",()=>{t.chosen&&Se(t.chosen,"ai")}),i.aBoard.appendChild(e)),Te()}function Ye(e,a,o){ke(),e.classList.add("chosen");let n=e.style.zIndex;e.style.zIndex=1e4;let r=document.createElement("div");r.className="stance-chooser";let s=document.createElement("button");s.className="btn",s.textContent="\u2694\uFE0F Ataque";let l=document.createElement("button");l.className="btn",l.textContent="\u{1F6E1}\uFE0F Defesa";let d=()=>{e.classList.remove("chosen"),e.style.zIndex=n,ke()};s.addEventListener("click",c=>{c.stopPropagation(),d(),a("attack")}),l.addEventListener("click",c=>{c.stopPropagation(),d(),a("defense")}),r.append(s,l),e.appendChild(r),Object.assign(r.style,{position:"absolute",left:"50%",bottom:"100%",transform:"translate(-50%, -8px)"}),setTimeout(()=>{let c=h=>{h.target.closest(".stance-chooser")||h.target===e||(window.removeEventListener("click",c,!0),d(),o&&o())};window.addEventListener("click",c,!0),s.focus()},0)}var ke=()=>{let e=document.querySelector(".stance-chooser");e&&e.remove(),document.querySelectorAll(".hand .card.chosen").forEach(a=>a.classList.remove("chosen"))};function Je(e,a){let o=e.getBoundingClientRect(),n=e.cloneNode(!0);Object.assign(n.style,{left:o.left+"px",top:o.top+"px",width:o.width+"px",height:o.height+"px",position:"fixed",zIndex:999,transition:"transform .45s ease,opacity .45s ease"}),n.classList.add("fly"),document.body.appendChild(n);let r=i.pBoard.getBoundingClientRect();requestAnimationFrame(()=>{let s=r.left+r.width/2-o.left-o.width/2,l=r.top+10-o.top;n.style.transform=`translate(${s}px,${l}px) scale(.9)`,n.style.opacity="0"}),setTimeout(()=>{n.remove(),a&&a()},450)}function U(e={}){let a=r=>(r.hp<1&&(r.hp=1),r.atk<0&&(r.atk=0),r),o=e.continueStory;if(t.mode=window.currentGameMode==="story"?"story":"solo",t.mode==="story"){t.story||(t.story=new _({level:1})),t.story.nextRound(),t.aiDeckChoice=b(ce);let r=t.story.currentEncounter==="boss";t.enemyScaling=t.story.scaling,t.currentEnemyName=Ne(t.aiDeckChoice,r),p(`Round ${t.story.round}: ${t.currentEnemyName} (${t.story.currentEncounter})`),ra(t.currentEnemyName,r?"boss":"enemy"),t.maxHandSize=10}else t.story=null,t.enemyScaling=0,t.maxHandSize=5;if(t.mode==="story"&&o)t.playerDeck.push(...t.playerHand,...t.playerBoard,...t.playerDiscard),t.playerHand=[],t.playerBoard=[],t.playerDiscard=[];else if(t.totems=[],t.playerDeck=t.playerDeckChoice==="custom"&&t.customDeck?t.customDeck.slice():G[t.playerDeckChoice].map(I),t.mode==="story"){let r=I(["Totem de For\xE7a","\u{1F5FF}","Totem",0,0,2,"Ative: +1/+1 em um aliado"]);r.type="totem",t.playerDeck.push(r)}let n=t.playerDeckChoice==="custom"?"custom":t.playerDeckChoice;t.playerCommander={...B[n]},t.playerItems=[],t.aiCommander={...B[t.aiDeckChoice]},t.aiItems=[],t.commanderBuffsDirty=!0,Z(t.playerDeck),t.playerDeck.forEach(r=>{a(r),r.owner="player",r.deck=t.playerDeckChoice==="custom"?"custom":t.playerDeckChoice}),t.aiDeck=G[t.aiDeckChoice].map(I),t.aiDeck.forEach(r=>{a(r),r.owner="ai",r.deck=t.aiDeckChoice,t.mode==="story"&&(r.atk+=t.enemyScaling,r.hp+=t.enemyScaling)}),Z(t.aiDeck),Qe(),t.playerDiscard=[],t.aiDiscard=[],t.playerHand=[],t.aiHand=[],t.playerBoard=[],t.aiBoard=[],t.playerHP=30,t.aiHP=30,t.current="player",t.playerMana=0,t.playerManaCap=0,t.playerHarvest=0,t.playerHarvestCap=0,t.aiMana=0,t.aiManaCap=0,t.aiHarvest=0,t.aiHarvestCap=0,j("player",3),j("ai",3),re(),w(),O(),H("combat"),p("A batalha come\xE7ou!"),k("start")}var Z=e=>{for(let a=e.length-1;a>0;a--){let o=Math.floor(Math.random()*(a+1));[e[a],e[o]]=[e[o],e[a]]}return e};function j(e,a=1){let o=e==="player"?t.playerDeck:t.aiDeck,n=e==="player"?t.playerHand:t.aiHand,r=e==="player"?t.playerDiscard:t.aiDiscard;for(let s=0;s<a;s++)if(o.length===0&&r.length&&(r.forEach(X),o.push(...Z(r.splice(0)))),o.length){let l=o.shift();if(X(l),l.hp<1&&(l.hp=1),n.length>=t.maxHandSize)r.push(l),_e(l);else if(n.push(l),e==="player"){k("draw");let d=document.getElementById("drawPile");if(d){let c=d.getBoundingClientRect();K("magic",c.left+c.width/2,c.top+c.height/2)}}}e==="player"&&(i.drawCount.textContent=t.playerDeck.length,i.discardCount.textContent=t.playerDiscard.length)}function _e(e){p(`${e.name} queimou por m\xE3o cheia!`),K("explosion",window.innerWidth/2,window.innerHeight/2)}function Qe(){let e=B[t.playerDeckChoice]||{},a=B[t.aiDeckChoice]||{};i.pAva&&(i.pAva.textContent=e.icon||"\u{1F464}"),i.aAva&&(i.aAva.textContent=a.icon||"\u{1F9FF}")}function Be(){!t.playerBoard.length||!t.totems.length||(t.playerBoard.forEach(e=>{e.atk=e.baseAtk??e.atk,e.hp=e.baseHp??e.hp,e.baseAtk=e.atk,e.baseHp=e.hp}),t.totems.forEach(e=>{let a=Math.min(3,t.playerBoard.length);Z([...t.playerBoard]).slice(0,a).forEach(n=>{e.buffs.atk&&(n.atk+=e.buffs.atk),e.buffs.hp&&(n.hp+=e.buffs.hp)})}))}function Xe(){let e=(a,o)=>{!a.length||!o||a.forEach(n=>{typeof n.itemAtk=="number"&&(n.atk-=n.itemAtk),typeof n.itemHp=="number"&&(n.hp-=n.itemHp);let r=(o.weapon?.atk||0)+(o.spell?.buff?.atk||0),s=(o.armor?.hp||0)+(o.spell?.buff?.hp||0);n.itemAtk=r,n.itemHp=s,n.atk+=r,n.hp+=s})};e(t.playerBoard,t.playerCommander),e(t.aiBoard,t.aiCommander)}function re(e){if(e&&na(e),t.current==="player"){if(t.mode==="story"&&t.story){let a=t.story.nextRound();t.enemyScaling=t.story.scaling,a.isBoss?p("Um Boss se aproxima!"):a.isElite?p("Encontro Elite \xE0 frente!"):a.isShop&&p("Um mercador misterioso aparece.")}t.playerManaCap=P(t.playerManaCap+1,0,10),t.playerMana=t.playerManaCap,t.playerHarvestCap=P(t.playerHarvestCap+1,0,10),t.playerHarvest=t.playerHarvestCap,j("player",1),t.playerBoard.forEach(a=>a.canAttack=!0)}else t.aiManaCap=P(t.aiManaCap+1,0,10),t.aiMana=t.aiManaCap,t.aiHarvestCap=P(t.aiHarvestCap+1,0,10),t.aiHarvest=t.aiHarvestCap,j("ai",1),t.aiBoard.forEach(a=>a.canAttack=!0);w()}function Ze(){t.current==="player"&&(t.current="ai",t.chosen=null,W(),re("player"),k("end"),setTimeout(()=>ye({G:t,summon:Me,renderAll:w,legalTarget:He,attackCard:Re,attackFace:Se,rand:b,newTurn:re}),500))}function ea(e,a){if(t.current!=="player")return;let o=t.playerHand.findIndex(s=>s.id===e);if(o<0)return;let n=t.playerHand[o],r=n.type!=="totem"&&t.playerBoard.length>=5;if(!(n.cost>t.playerMana||n.harvestCost>t.playerHarvest||r)){if(t.playerHand.splice(o,1),t.playerMana-=n.cost,t.playerHarvest-=n.harvestCost,n.type==="totem"){if(t.totems.length>=3)p("N\xFAmero m\xE1ximo de Totens atingido."),t.playerDiscard.push(n);else{let s=n.buffs||{atk:1,hp:1},l={name:n.name,buffs:s};t.totems.push(l),t.story&&t.story.addTotem(l),Be(),p(`${n.name} ativado.`)}w();return}Me("player",n,a),w(),k(a==="defense"?"defense":"play")}}function Me(e,a,o="attack"){let n=e==="player"?t.playerBoard:t.aiBoard;a.stance=o,a.canAttack=o==="attack"&&a.kw.includes("Furioso"),e==="ai"&&t.mode==="story"&&(a.atk+=t.enemyScaling,a.hp+=t.enemyScaling),n.push(a),M(a.id,"summon"),p(`${e==="player"?"Voc\xEA":"Inimigo"} jogou ${a.name} em modo ${o==="defense"?"defesa":"ataque"}.`),aa(e,a),a.kw.includes("Absorver")&&ta(e,a),o==="defense"&&setTimeout(()=>de(a.id),30),e==="player"&&Be()}function aa(e,a){let o=e==="player"?"ai":"player";switch(a.battlecry){case"draw1":j(e,1),p(`${a.name}: comprou 1 carta.`);break;case"heal2":{let n=e==="player"?t.playerBoard:t.aiBoard;if(n.length){let r=b(n);r.hp=Math.min(r.hp+2,20),x(r.id,"+2","heal");let s=R(r.id);if(s){let l=s.getBoundingClientRect();K("healing",l.left+l.width/2,l.top+l.height/2)}p(`${a.name}: curou 2 em ${r.name}.`)}}break;case"ping1":{let n=o==="ai"?t.aiBoard:t.playerBoard;if(n.length){let r=b(n);ee(r,1),M(r.id,"attack"),x(r.id,"-1","dmg"),p(`${a.name}: 1 de dano em ${r.name}.`),ae(),w(),k("hit")}}break;case"buffRandom1":{let n=(e==="player"?t.playerBoard:t.aiBoard).filter(r=>r.id!==a.id);if(n.length){let r=b(n);r.atk+=1,r.hp+=1,x(r.id,"+1/+1","buff"),M(r.id,"magic"),p(`${a.name}: deu +1/+1 em ${r.name}.`)}}break;case"buffAlliesAtk1":{let n=(e==="player"?t.playerBoard:t.aiBoard).filter(r=>r.id!==a.id);n.forEach(r=>{r.atk+=1,x(r.id,"+1 ATK","buff"),M(r.id,"magic")}),n.length&&p(`${a.name}: aliados ganharam +1 de ataque.`)}break}}function ta(e,a){let n=(e==="player"?t.playerBoard:t.aiBoard).filter(d=>d.id!==a.id&&d.kw&&d.kw.length);if(!n.length)return;let s=b(n).kw.filter(d=>!a.kw.includes(d));if(!s.length)return;let l=b(s);a.kw.push(l),M(a.id,"magic"),x(a.id,l,"buff"),p(`${a.name} absorveu ${l}.`),a.name==="Sombra R\xFAnica"&&(a.atk+=1,a.hp+=1),a.name==="Capataz de Runas"&&((e==="player"?t.aiBoard:t.playerBoard).forEach(c=>{ee(c,1),M(c.id,"attack"),x(c.id,"-1","dmg")}),ae())}function na(e){let a=e==="player"?t.playerBoard:t.aiBoard,o=e==="player"?t.aiBoard:t.playerBoard;for(let n of a){if(n.kw.includes("Mut\xE1vel")){let r=n.atk;n.atk=n.hp,n.hp=r,x(n.id,"\u21C6","buff")}if(n.name==="Totem Absorvente"){let r=o.filter(s=>s.kw&&s.kw.length);if(r.length){let s=b(r),l=s.kw.filter(d=>!n.kw.includes(d));if(l.length){let d=b(l);n.kw.push(d),M(n.id,"magic"),x(n.id,d,"buff"),p(`${n.name} absorveu ${d} de ${s.name}.`)}}}}}function W(){document.body.classList.toggle("targeting",!!t.chosen)}function Pe(){if(!t.chosen)return!1;if(t.current!=="player")return t.chosen=null,document.body.classList.remove("targeting"),!1;let e=t.playerBoard.find(a=>a.id===t.chosen.id);return!e||!e.canAttack||e.stance==="defense"?(t.chosen=null,document.body.classList.remove("targeting"),!1):(t.chosen=e,!0)}function xe(){t.chosen&&(t.chosen=null,W(),i.aBoard.classList.remove("face-can-attack"),le())}function oa(e){t.current!=="player"||!e.canAttack||e.stance==="defense"||(t.chosen=e,W(),le(),Te(),t.aiBoard.filter(a=>a.stance==="defense").forEach(a=>setTimeout(()=>de(a.id),20)))}function Te(){let e=Ee(t.aiBoard),o=Pe()&&!e,n=document.querySelector("#aiBoard .face-attack-btn");o?(i.aBoard.classList.add("face-can-attack"),n&&(n.style.display="block")):(i.aBoard.classList.remove("face-can-attack"),n&&(n.style.display="none"))}function He(e,a){let o=e==="ai"?t.aiBoard:t.playerBoard;return Ee(o)?a.kw.includes("Protetor")||a.stance==="defense":!0}var R=e=>document.querySelector(`.card[data-id="${e}"]`),se=(e,a,o=400)=>{e&&e.classList.add(a),setTimeout(()=>e&&e.classList.remove(a),o)},Le=(e,a)=>{let o=R(e),n=a?R(a):null;se(o,"attack-lunge",350),n&&se(n,"hit-shake",350)},de=e=>{let a=R(e);se(a,"shield-flash",600)};function we(e,a,o){let n=document.createElement("div");n.className="fx fx-slash",n.style.left=e+"px",n.style.top=a+"px",n.style.setProperty("--ang",o+"deg"),document.body.appendChild(n),setTimeout(()=>n.remove(),380)}function K(e,a,o){let n=document.createElement("div");n.className="fx fx-"+e,n.style.left=a+"px",n.style.top=o+"px",document.body.appendChild(n),setTimeout(()=>n.remove(),600)}function ra(e,a="enemy"){let o=document.getElementById("encounterBanner");o&&(o.textContent=e,o.className=a+" show",setTimeout(()=>o.classList.remove("show"),1500))}function M(e,a){let o=R(e);if(!o)return;let n=o.getBoundingClientRect();K(a,n.left+n.width/2,n.top+n.height/2)}function ie(e,a){let o=e==="ai"?i.barAHP||i.aHP2:i.barPHP||i.pHP2;if(!o)return;let n=o.getBoundingClientRect();K(a,n.left+n.width/2,n.top+n.height/2)}function x(e,a,o){let n=document.querySelector(`.card[data-id="${e}"]`);if(!n)return;let r=n.getBoundingClientRect(),s=document.createElement("div");s.className="fx-float "+(o||""),s.textContent=a,s.style.left=r.left+r.width/2+"px",s.style.top=r.top+r.height/2+"px",document.body.appendChild(s),setTimeout(()=>s.remove(),950)}function be(e,a,o){let n=e==="ai"?i.barAHP||i.aHP2:i.barPHP||i.pHP2;if(!n)return;let r=n.getBoundingClientRect(),s=document.createElement("div");s.className="fx-float "+(o||""),s.textContent=a,s.style.left=r.left+r.width/2+"px",s.style.top=r.top+r.height/2+"px",document.body.appendChild(s),setTimeout(()=>s.remove(),950)}function Re(e,a){if(!e||!e.canAttack||e.stance==="defense")return;k("attack");let o=R(e.id),n=R(a.id);if(o&&n){let l=o.getBoundingClientRect(),d=n.getBoundingClientRect();we(l.right,l.top+l.height/2,15)}Le(e.id,a.id),a.stance==="defense"&&de(a.id),M(a.id,"attack");let r=a.hp,s=Math.max(0,e.atk-r);if(ee(a,e.atk),ee(e,a.atk),k("hit"),s>0&&a.hp<=0){let l=t.playerBoard.includes(e);if(k("overflow"),l){let d=t.aiCommander?.armor?.hp||0,c=Math.max(0,s-d);t.aiHP=P(t.aiHP-c,0,99),p(`${e.name} excedeu em ${s} e causou dano direto ao Inimigo!`),ie("ai","attack")}else{let d=t.playerCommander?.armor?.hp||0,c=Math.max(0,s-d);t.playerHP=P(t.playerHP-c,0,99),p(`${e.name} excedeu em ${s} e causou dano direto a Voc\xEA!`),ie("player","attack")}$e()}e.canAttack=!1,p(`${e.name} atacou ${a.name}.`),ae(),w(),t.chosen=null,W(),i.aBoard.classList.remove("face-can-attack")}function Se(e,a){if(!e||!e.canAttack||e.stance==="defense")return;k("attack");let o=R(e.id);if(o){let l=o.getBoundingClientRect();we(l.right,l.top+l.height/2,10)}Le(e.id,null),ie(a,"attack");let r=(a==="ai"?t.aiCommander:t.playerCommander)?.armor?.hp||0,s=Math.max(0,e.atk-r);e.canAttack=!1,a==="ai"?(be("ai","-"+s,"dmg"),t.aiHP=P(t.aiHP-s,0,99),p(`${e.name} causou ${s} ao Inimigo!`),k("crit")):(be("player","-"+s,"dmg"),t.playerHP=P(t.playerHP-s,0,99),p(`${e.name} causou ${s} a Voc\xEA!`),k("hit")),$e(),t.chosen=null,W(),i.aBoard.classList.remove("face-can-attack"),w()}function ee(e,a){!e||typeof a!="number"||(x(e.id,"-"+a,"dmg"),e.hp=P(e.hp-a,0,99),e.hp<=0&&setTimeout(ae,10))}function ae(){let e=t.aiBoard.filter(o=>o.hp<=0);e.forEach(o=>{M(o.id,"explosion"),k("death"),X(o)}),e.length&&(t.aiBoard=t.aiBoard.filter(o=>o.hp>0),t.aiDiscard.push(...e),p("Uma criatura inimiga caiu."));let a=t.playerBoard.filter(o=>o.hp<=0);a.forEach(o=>{M(o.id,"explosion"),k("death"),X(o)}),a.length&&(t.playerBoard=t.playerBoard.filter(o=>o.hp>0),t.playerDiscard.push(...a),p("Sua criatura caiu.")),i.discardCount.textContent=t.playerDiscard.length}function sa(e){let a=document.createElement("div");a.className="boom",a.style.left="50%",a.style.top="50%",a.style.background=`radial-gradient(circle at 50% 50%, ${e?"#8bf5a2":"#ff8a8a"}, transparent)`,document.body.appendChild(a),setTimeout(()=>a.remove(),650)}function Ae(e){O(),i.endMsg.textContent=e?"You WIN!":"You Lose...",i.endMsg.style.color=e?"#8bf5a2":"#ff8a8a",i.endSub.textContent=e?"Parab\xE9ns! Quer continuar jogando?":"Tentar de novo ou voltar ao menu.",i.endOverlay.classList.add("show"),setTimeout(()=>sa(e),1e3)}function $e(){if(t.aiHP<=0){if(t.mode==="story"&&t.story){let{leveled:e,rewards:a}=t.story.handleVictory();p(`Recompensas dispon\xEDveis: ${a.join(", ")}`),e&&p(`Voc\xEA alcan\xE7ou o n\xEDvel ${t.story.level}!`),setTimeout(()=>U({continueStory:!0}),1e3);return}Ae(!0)}t.playerHP<=0&&Ae(!1)}function ia(){let e=[];for(let a of Object.keys(G))for(let o of G[a]){let n=I(o);n.deck=a,e.push(n)}return e}function ue(e="all",a=!1){i.encyGrid.innerHTML="",(e==="all"?ia():G[e].map(I).map(n=>Object.assign(n,{deck:e}))).forEach(n=>{let r=document.createElement("div");r.className=`card ency-card bg-${n.deck}`,r.innerHTML=`<div class='bg bg-${n.deck}'></div><div class='head'><span class='cost'>${n.cost}${n.harvestCost?`\u{1F33E}${n.harvestCost}`:""}</span><div class='name'>${n.name}</div></div><div class='mini'>${n.tribe} \u2022 \u2694\uFE0F ${n.atk} / \u2764\uFE0F ${n.hp}</div><div class='art'>${n.emoji}</div><div class='details'><div>${(n.kw||[]).map(s=>`<span class='chip' data-type='keyword' data-tip='${s==="Protetor"?"Enquanto houver Protetor ou carta em Defesa do lado do defensor, ataques devem mir\xE1-los.":s==="Furioso"?"Pode atacar no turno em que \xE9 jogada.":""}' >${s}</span>`).join(" ")}</div><div style='margin-top:6px'>${n.text||""}</div></div>`,Q(r),i.encyGrid.appendChild(r)}),i.ency.classList.add("show"),i.encyFilters.style.display=a?"none":"flex",F(".filters .fbtn").forEach(n=>n.classList.toggle("active",n.dataset.deck===e||e==="all"&&n.dataset.deck==="all"))}i.endBtn.addEventListener("click",Ze);i.muteBtn.addEventListener("click",()=>{V(),L(),he(i.muteBtn)});window.addEventListener("keydown",e=>{if(e.key!=="Escape")return;if(t.chosen){xe();return}if(!i.gameMenu)return;i.gameMenu.classList.contains("show")?i.gameMenu.classList.remove("show"):(i.gameMenu.classList.add("show"),i.restartBtn&&(i.restartBtn.style.display=window.isMultiplayer?"none":"block"))});document.addEventListener("click",e=>{t.chosen&&(e.target.closest("#aiBoard .card.selectable")||e.target.closest("#playerBoard .card.selectable")||e.target.closest("#aiBoard .face-attack-btn")||xe())},{capture:!0});F(".deckbtn").forEach(e=>{e.addEventListener("pointermove",o=>{let n=e.getBoundingClientRect();e.style.setProperty("--px",(o.clientX-n.left)/n.width*100+"%"),e.style.setProperty("--py",(o.clientY-n.top)/n.height*100+"%")}),e.addEventListener("mouseenter",()=>{e.style.setProperty("--halo",.7),e.style.setProperty("--shine",.7)}),e.addEventListener("mouseleave",()=>{e.style.removeProperty("--halo"),e.style.removeProperty("--shine")}),e.addEventListener("click",()=>{let o=e.dataset.deck;t.playerDeckChoice=o,t.aiDeckChoice=b(ce.filter(n=>n!==o)),t.playerCommander={...B[o]||B.vikings},t.aiCommander={...B[t.aiDeckChoice]||B.vikings},t.commanderBuffsDirty=!0,H(o),F(".deckbtn").forEach(n=>n.style.outline="none"),e.style.outline="2px solid var(--accent)"});let a=e.querySelector(".view-cards");a&&a.addEventListener("click",o=>{o.stopPropagation(),ue(e.dataset.deck,!0)})});i.startGame.addEventListener("click",()=>{i.start.style.display="none",V(),L(),O(),U()});i.openEncy.addEventListener("click",()=>ue("all",!1));i.closeEncy.addEventListener("click",()=>{i.ency.classList.remove("show")});F(".filters .fbtn").forEach(e=>e.addEventListener("click",()=>{ue(e.dataset.deck,!1)}));i.playAgainBtn.addEventListener("click",()=>{i.endOverlay.classList.remove("show"),U()});i.rematchBtn.addEventListener("click",()=>{i.endOverlay.classList.remove("show"),U()});i.menuBtn.addEventListener("click",()=>{i.endOverlay.classList.remove("show"),i.start.style.display="grid",H("menu")});Ce();i.playerCommander&&i.playerCommander.addEventListener("click",oe);i.pAva&&i.pAva.addEventListener("click",oe);window.G=t;window.startGame=U;document.addEventListener("DOMContentLoaded",ne);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&ne()});window.addEventListener("pointerdown",()=>{V(),L(),H("menu")},{once:!0});})();
