<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FFF Farm Fight Formula ‚Äî Online</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1020;--panel:#101833;--panel2:#0f1430;--accent:#7cc4ff;--accent2:#ffd166;--good:#4ade80;--bad:#fb7185;--muted:#a7b0d9;--card:#141d3f;--card2:#1a2454;--text:#e6e9ff}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 700px at 20% 0%,#0e1340 0%,var(--bg) 60%);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{margin:4px 0 6px;font-size:clamp(20px,4vw,36px)}
    .sub{color:var(--muted);margin-bottom:16px}
    .hud{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;margin:10px 0 14px}
    .meter{display:flex;gap:8px;align-items:center;background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #243069;border-radius:14px;padding:8px 10px}
    .meter b{font-size:14px;color:var(--muted)}
    .meter .value{font-size:18px}
    .bar{flex:1;max-width:160px;height:6px;background:#243069;border-radius:3px;overflow:hidden;margin-left:6px}
    .fill{height:100%;width:0%;background:linear-gradient(90deg,var(--good),var(--accent))}
    .enemy-hp .fill{background:linear-gradient(90deg,var(--bad),var(--accent2))}
    .btn{cursor:pointer;border:none;border-radius:12px;padding:10px 14px;background:linear-gradient(180deg,#2a3c7e,#1b2a5b);color:#fff;font-weight:800;letter-spacing:.2px}
    .btn-ghost{cursor:pointer;border:1px solid #2b3a86;background:#0c1230;color:#cfe3ff;border-radius:10px;padding:8px 10px}
    .muted{color:var(--muted)}
    .input{border:1px solid #2b3a86;background:#0c1230;color:#cfe3ff;border-radius:10px;padding:8px 10px}
    .mpbar{position:fixed;top:0;left:0;right:0;background:linear-gradient(180deg,#121a44,#0c1230);border-bottom:1px solid #2b3a86;padding:8px 10px;display:flex;flex-direction:column;gap:6px;z-index:20}
    .mprow{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

    .zone-title{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin:6px 0 4px}
    .board{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:14px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));border-radius:16px;padding:18px 12px;min-height:200px;border:1px dashed #31408b;position:relative}

    .hand{display:flex;flex-wrap:wrap;gap:18px;margin:22px 0 8px}
    .card{width:188px;aspect-ratio:10/14;background:linear-gradient(180deg,var(--card2),var(--card));border-radius:18px;border:1px solid #28336b;box-shadow:0 10px 20px rgba(0,0,0,.35),inset 0 0 0 1px rgba(255,255,255,.06);padding:6px;display:grid;grid-template-rows:auto 1fr auto;position:relative;overflow:hidden;transition:transform .18s ease,box-shadow .18s ease}
    #playerBoard .card:hover{transform:translateY(-6px) scale(1.03);box-shadow:0 16px 30px rgba(0,0,0,.45),0 0 0 2px rgba(124,196,255,.15) inset}
    .card .art{display:grid;place-items:center;font-size:58px;transform:translate3d(0,0,0)}
    .cost{display:grid;place-items:center;width:22px;height:22px;border-radius:50%;font-weight:900;color:#02122e;background:radial-gradient(circle at 30% 30%,#aee5ff,#4aa3ff);box-shadow:0 8px 14px rgba(74,163,255,.35),inset 0 0 18px rgba(255,255,255,.35)}
    .head{display:grid;grid-template-columns:auto 1fr auto;gap:8px;align-items:center}
    .name{font-weight:800;font-size:15px;line-height:1.12}
    .tribe{font-size:12px;color:var(--muted)}
    .text{font-size:12px;color:#d9e3ff;background:#0e1435;border:1px solid #25306a;border-radius:10px;padding:8px;margin-top:6px}
    .stats{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
    .gem{padding:6px 10px;border-radius:999px;font-size:12px;font-weight:900;display:inline-flex;align-items:center;gap:6px;border:1px solid rgba(255,255,255,.08)}
    .atk{background:linear-gradient(180deg,#233b7a,#1a2f66)}
    .hp{background:linear-gradient(180deg,#2a5f3a,#1e462b)}
    .hp.low{background:linear-gradient(180deg,#7a2e36,#5a1f25)}
    .badge{font-size:10px;padding:3px 6px;border-radius:999px;border:1px solid rgba(255,255,255,.14)}
    .def{background:linear-gradient(180deg,#2a5f3a,#1e462b)}
    .atkBadge{background:linear-gradient(180deg,#1f2a64,#15204a)}
    .keyword{display:inline-block;background:linear-gradient(180deg,#6342b6,#3b1f7e);padding:2px 6px;border-radius:999px;font-size:11px;margin-right:6px;border:1px solid rgba(255,255,255,.12)}
    .selectable{outline:2px solid rgba(124,196,255,.8);box-shadow:0 0 0 6px rgba(124,196,255,.2)}

    .start{position:fixed;inset:0;background:radial-gradient(1200px 700px at 80% 20%,#10236a 0%,#0b1020 60%);display:grid;place-items:center;z-index:10}
    .start .panel{background:linear-gradient(180deg,#121a44,#0c1230);border:1px solid #2b3a86;border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,.5);padding:24px;max-width:900px;width:min(94vw,900px)}
    .deckpick{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .deckbtn{display:flex;flex-direction:column;align-items:flex-start;gap:6px}

    .face-attack-btn{position:absolute;top:8px;right:8px;z-index:5;padding:8px 12px;border-radius:10px;border:1px solid rgba(124,196,255,.35);background:linear-gradient(180deg,#2a3c7e,#1b2a5b);box-shadow:inset 0 0 0 1px rgba(255,255,255,.08),0 10px 24px rgba(0,0,0,.35);color:#e6e9ff;font-weight:800;display:none}
    .face-can-attack{outline:2px dashed rgba(124,196,255,.35)}

    .winpanel{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.35);z-index:20}
    .winpanel.show{display:grid}
    .winbox{background:linear-gradient(180deg,#121a44,#0c1230);border:1px solid #2b3a86;border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,.5);padding:24px;min-width:320px;text-align:center}
    .titleWin{font-size:46px;font-weight:900;margin:0 0 6px;color:#BFFFCF;}
    .titleLose{color:#FFBFBF}
    .winBtns{display:flex;gap:8px;justify-content:center;margin-top:10px}

    @media (max-width:720px){.board{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.card{width:150px}.name{font-size:13px}}
  </style>
  <link rel="stylesheet" href="fff-effects.css">
</head>
<body>
  <!-- Barra Multiplayer -->
  <div class="mpbar">
    <div class="mprow">
      <span class="muted">Multiplayer (beta):</span>
      <span id="mpStatus" class="muted">Modo: Solo</span>
    </div>
    <div class="mprow">
      <input id="mpWs" class="input" placeholder="WS (vazio = mesmo dom√≠nio)" value="">
      <input id="mpRoom" class="input" placeholder="Sala" value="duo">
      <input id="mpName" class="input" placeholder="Seu nome" value="Player">
      <button id="mpHost" class="btn">Hospedar</button>
      <button id="mpJoin" class="btn">Entrar</button>
      <button id="mpLeave" class="btn-ghost">Sair</button>
    </div>
  </div>
  <div class="start" id="start">
    <div class="panel">
      <h1>Farm Fight Formula <small style="color:var(--muted);font-size:16px">‚Äî Online</small></h1>
      <p class="sub">Escolha um deck e parta para a arena.</p>
      <div class="deckpick">
        <button class="btn deckbtn" data-deck="vikings">üë©‚Äçüåæ Fazendeiros Vikings <small style="color:var(--muted)">Cura e prote√ß√£o</small></button>
        <button class="btn deckbtn" data-deck="animais">üê∫ Bestas do Norte <small style="color:var(--muted)">Ataque bruto</small></button>
        <button class="btn deckbtn" data-deck="pescadores">üé£ Pescadores do Fiorde <small style="color:var(--muted)">Suporte e b√¥nus</small></button>
        <button class="btn deckbtn" data-deck="floresta">üå≤ Feras da Floresta <small style="color:var(--muted)">Press√£o constante</small></button>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn" id="startGame">Jogar</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <h1>Farm Fight Formula</h1>
    <div class="hud">
      <div class="meter hp-meter"><b>Seu HP</b> <span class="value" id="playerHP">30</span><div class="bar"><div class="fill" id="barPlayerHP"></div></div></div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="meter mana-meter"><b>Mana</b> <span class="value" id="mana">0/0</span><div class="bar"><div class="fill" id="barMana"></div></div></div>
        <button class="btn" id="endTurnBtn">Encerrar turno</button>
        <button class="btn-ghost" id="muteBtn">üîä Som</button>
      </div>
      <div class="meter enemy-hp" style="justify-self:end"><b>HP Inimigo</b> <span class="value" id="aiHP">30</span><div class="bar"><div class="fill" id="barAiHP"></div></div></div>
    </div>

    <div class="zone-title">Tabuleiro do Inimigo</div>
    <div class="board" id="aiBoard"></div>

    <div class="zone-title">Seu Tabuleiro</div>
    <div class="board" id="playerBoard"></div>

    <div class="zone-title">Sua M√£o</div>
    <div class="hand" id="playerHand"></div>

    <div class="zone-title">Registro</div>
    <div id="log" style="max-height:160px;overflow:auto;background:linear-gradient(180deg,#0e1331,#0a0f27);border:1px solid #243069;border-radius:12px;padding:8px;color:#c9d2ff"></div>
  </div>

  <div id="win" class="winpanel"><div class="winbox"><h2 id="winTitle" class="titleWin">You WIN!</h2><div class="sub">Parab√©ns! Quer continuar jogando?</div><div class="winBtns"><button class="btn" id="btnReplay">Jogar de novo</button><button class="btn" id="btnRematch">Revanche</button><button class="btn-ghost" id="btnMenu">Menu inicial</button></div></div></div>

  <!-- Inclua o cliente do Socket.IO (servido pelo seu server Node / Express) -->
  <script src="/socket.io/socket.io.js"></script>
  <!-- Cliente de rede -->
  <script src="fffonline-net-client.js"></script>
  <script src="app.js"></script>
  <script>
  const NET_STATE = { online:false };
  window.addEventListener("net:mode", e=>{
    NET_STATE.online = !!e.detail.online;
  });

  const _aiTurn = aiTurn;
  aiTurn = function(){
    if(NET_STATE.online) return;
    return _aiTurn.apply(this, arguments);
  };

  window.addEventListener("net:ready", (e)=>{
    const { seed, hostDeck, guestDeck } = e.detail;
    document.getElementById('start')?.style.display='none';
    const youAreHost = NET.isHost;
    const yourDeck = youAreHost ? hostDeck : guestDeck;
    const enemyDeck = youAreHost ? guestDeck : hostDeck;
    const yourPrefix = youAreHost ? 'H-' : 'G-';
    const enemyPrefix = youAreHost ? 'G-' : 'H-';
    setSeed(seed);
    S.playerDeck = shuffle(makeDeck(yourDeck, seed, yourPrefix), seed);
    S.aiDeck     = shuffle(makeDeck(enemyDeck, seed+1, enemyPrefix), seed+1);
    S.current = youAreHost ? 'player' : 'ai';
    S.playerHand=[]; S.aiHand=[]; S.playerBoard=[]; S.aiBoard=[];
    S.playerHP=30; S.aiHP=30; S.playerMana=0; S.playerManaCap=0; S.aiMana=0; S.aiManaCap=0;
    draw('player',3); draw('ai',3);
    newTurn(); renderAll();
  });

  function sendOrApply(act){
    if(NET_STATE.online){
      NET.send('act', act);
    }else{
      applyAct(act);
    }
  }
  window.addEventListener("net:event",(e)=>{
    const {type,payload}=e.detail;
    if(type==='act') applyAct(payload);
  });

  const _playFromHand = playFromHand;
  playFromHand = function(id, stance){
    if(!NET_STATE.online) return _playFromHand(id, stance);
    sendOrApply({ type:'play', id, stance });
  };

  const _endTurn = endTurn;
  endTurn = function(){
    if(!NET_STATE.online) return _endTurn();
    sendOrApply({ type:'end' });
  };

  const _attackCard = attackCard;
  attackCard = function(attacker, target){
    if(!NET_STATE.online) return _attackCard(attacker, target);
    sendOrApply({ type:'attackCard', attacker: attacker.id, target: target.id });
  };

  const _attackFace = attackFace;
  attackFace = function(attacker, face){
    if(!NET_STATE.online) return _attackFace(attacker, face);
    sendOrApply({ type:'attackFace', attacker: attacker.id, face });
  };

  function applyAct(act){
    switch(act.type){
      case 'play': {
        const inPlayer = S.playerHand.some(c=>c.id===act.id);
        if(inPlayer) {
          _playFromHand(act.id, act.stance);
        } else {
          const idx=S.aiHand.findIndex(c=>c.id===act.id);
          if(idx>-1){
            const c=S.aiHand[idx];
            if(S.aiBoard.length<5){
              S.aiHand.splice(idx,1);
              summon('ai',c,act.stance);
              S.aiMana-=c.cost;
              renderAll();
              sfx(act.stance==='defense'?'defense':'play');
            }
          }
        }
      } break;
      case 'end': {
        if(S.current==='player'){
          _endTurn();
        }else{
          S.current='player';
          S.chosenAttacker=null;
          updateFaceAttackZone();
          newTurn();
        }
      } break;
      case 'attackCard': {
        const atk = [...S.playerBoard, ...S.aiBoard].find(c=>c.id===act.attacker);
        const tgt = [...S.playerBoard, ...S.aiBoard].find(c=>c.id===act.target);
        if(atk && tgt) _attackCard(atk, tgt);
      } break;
      case 'attackFace': {
        const atk = [...S.playerBoard, ...S.aiBoard].find(c=>c.id===act.attacker);
        if(atk) _attackFace(atk, act.face);
      } break;
      default: console.warn('act?', act);
    }
  }

  document.getElementById('startGame')?.addEventListener('click',(ev)=>{
    if(NET_STATE.online){
      ev.preventDefault();
    }else{
      // offline flow handled in app.js
    }
  });

  </script>
  <script defer src="fff-effects.js"></script>
</body>
</html>
